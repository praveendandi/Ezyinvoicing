<div class="container-fluid h-100vh">
  <section >
    <div class="row py-3 filter-card shadow-sm">
        <div class="col-md-5 grid">
            <div class="d-flex align-items-center">
                <h6 class="m-0"><b>Summaries ({{filters.totalCount}})</b></h6>
                <button [routerLink]="[ '/clbs/create-summary' ]" class="btn btn-primary btn-sm shadow ml-3" type="button" appPermissionButton accessType="create"><b><i class="ri-add-line btn-hover-gray"></i></b></button>
            </div>
        </div>
    </div>

    <div class=" card row mt-3 list-table shadow-sm">
        <div class="col-md-12 p-0">
            <div class="table-responsive">
                <table class="table table-hover">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Summary ID</th>
                            <th>Summary</th>
                            <th>Type</th>
                            <th>Company</th>
                            <th>Date</th>
                            <th>Generated On</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                        <tr >
                          <td></td>
                          <td>
                              <div class="input-group input-group-sm">
                                  <div class="input-group-prepend">
                                      <span class="input-group-text">
                                          <i class="ri-search-line"></i>
                                      </span>
                                  </div>
                                  <input #idInp type="search" [(ngModel)]="filters.summaryId" (keyup)="onSearch.emit(filters)" (search)="onSearch.emit(filters)" (keyup.enter)="updateRouterParams()" class="form-control">
                              </div>
                          </td>
                          <td>
                              <div class="input-group input-group-sm">
                                  <div class="input-group-prepend">
                                      <span class="input-group-text">
                  <i class="ri-search-line"></i>
                </span>
                                  </div>
                                  <input #summaryInp type="search" [(ngModel)]="filters.search" (keyup)="onSearch.emit(filters)" (search)="onSearch.emit(filters)" (keyup.enter)="updateRouterParams()" class="form-control">
                              </div>
                          </td>
                          <td></td>
                          <td>
                              <div class="input-group input-group-sm">
                                  <div class="input-group-prepend">
                                      <span class="input-group-text">
                  <i class="ri-search-line"></i>
                </span>
                                  </div>
                                  <input #taxpayerInp type="search" [(ngModel)]="filters.taxpayer" (keyup)="onSearch.emit(filters)" (search)="onSearch.emit(filters)" (keyup.enter)="updateRouterParams()" class="form-control">
                              </div>
                          </td>
                          <td></td>
                          <td></td>
                          <td>
                              <div class="form-group mb-0">
                                  <select id="summaryStatus" class="custom-select" [(ngModel)]="filters.status" (change)="onSearch.emit(filters)">
                                  <option value="">Showing all</option>
                                  <option value="Submitted">Submitted</option>
                                  <option value="Draft">Draft</option>
                                  <option value="Cancelled">Cancelled</option>
                                  <option value="Void">Void</option>
                                  </select>
                              </div>
                          </td>
                          <td></td>
                      </tr>
                    </thead>
                    <tbody>

                        <tr *ngFor="let item of summariList;let i = index" class="summary-table-tr"  [ngClass]="{'cursor-pointer':(item?.status !== 'Void' && item?.status !== 'Cancelled')}">
                            <td (click)=" item?.status !== 'Void'? gotoSummaryDetails(item):''" class="text-center">
                                {{i+1}}
                            </td>
                            <td  (click)=" (item?.status !== 'Void' && item?.status !== 'Cancelled')? gotoSummaryDetails(item):''">{{item?.name}}</td>
                            <td  (click)=" (item?.status !== 'Void' && item?.status !== 'Cancelled')? gotoSummaryDetails(item):''">{{item?.summary_title}}</td>
                            <td  (click)=" (item?.status !== 'Void' && item?.status !== 'Cancelled')? gotoSummaryDetails(item):''">{{item?.event_type}}</td>
                            <td  (click)=" (item?.status !== 'Void' && item?.status !== 'Cancelled')? gotoSummaryDetails(item):''">{{item?.tax_payer_details}}</td>
                            <td  (click)=" (item?.status !== 'Void' && item?.status !== 'Cancelled')? gotoSummaryDetails(item):''">{{item?.between_dates}}</td>
                            <!-- <td>{{item?.documents || 0}}</td> -->
                            <!-- <td> <span class="status px-2 py-1">{{item?.status}}</span></td> -->
                            <td  (click)=" (item?.status !== 'Void' && item?.status !== 'Cancelled')? gotoSummaryDetails(item):''">{{item?.creation | date:'medium'}}</td>
                            <td  (click)=" (item?.status !== 'Void' && item?.status !== 'Cancelled')? gotoSummaryDetails(item):''"> <span class="badge" [ngClass]="{'badge-success': item?.status == 'Submitted','badge-warning':item?.status == 'Void','badge-default':item?.status == 'Draft'}">{{item?.status}}</span>
                                <span *ngIf="item?.name == summaryStatus?.summary && showProgress ">
                                    <ngb-progressbar [animated]="true" [title]="'Amend summary status'" [type]="summaryStatus?.percentage == 100 ? 'success' : 'warning' "  textType="white" [value]="summaryStatus?.percentage" [showValue]="true">
                                    </ngb-progressbar>
                                </span>
                            </td>
                            <td class="">
                                <span *ngIf="(item?.status !== 'Void' && item?.status !== 'Cancelled')" class="actions  cursor-pointer" (click)="gotoSummaryDetails(item)" [ngbTooltip]="'View'"><i class="ri-eye-line btn-hover-gray p-1"></i></span>
                                <span *ngIf="item?.status == 'Draft' || item?.status == 'Void'" class="actions  cursor-pointer" (click)="deleteSummary(item,'Deleted')" [ngbTooltip]="'Delete'"><i class="ri-delete-bin-line btn-hover-gray p-1"></i></span>
                                <span  *ngIf="item?.status == 'Submitted'" class="actions  cursor-pointer" (click)="emailLogOpen(emailLog,item?.name)" [ngbTooltip]="'Email Logs'"><i class="ri-mail-send-line btn-hover-gray p-1"></i></span>

                                <span *ngIf="item?.status == 'Submitted'" class="actions  cursor-pointer" (click)="deleteSummary(item,'Void')" [ngbTooltip]="'Void'"><i class="ri-creative-commons-zero-line btn-hover-gray p-1"></i></span>
                                <span *ngIf="item?.status == 'Submitted'" class="actions cursor-pointer" (click)="dispatchTempFunc(dispatchTemp,item)" [ngbTooltip]="'Dispatch'"><i class="ri-truck-line btn-hover-gray p-1"></i></span>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>
    <div class="d-flex justify-content-between morec" *ngIf="summariList.length">
      <div class="text-right px-3">
          <ng-container *ngIf="summariList.length  < this.filters.totalCount">
              <p class="cursor-pointer px-2 py-1 pagination " (click)="this.filters.start = summariList.length;this.filters.currentPage = this.filters.currentPage+1;  updateRouterParams()">
                  more
              </p>
          </ng-container>
      </div>
      <div class="px-3">
          <div class="row no-gutters pagination" *ngIf="summariList.length > this.filters.itemsPerPage">
              <p class="px-2 py-1 mb-0 cursor-pointer border-right" (click)="checkPagination(20)" [ngClass]="{'bg-count': filters.itemsPerPage == 20 }">20</p>
              <p class="px-2 py-1 mb-0 cursor-pointer border-right" (click)="checkPagination(50)" [ngClass]="{'bg-count': filters.itemsPerPage == 50 }">50</p>
              <p class="px-2 py-1 mb-0 cursor-pointer border-right" (click)="checkPagination(100)" [ngClass]="{'bg-count': filters.itemsPerPage == 100 }">100</p>
              <p class="px-2 py-1 mb-0 cursor-pointer" (click)="checkPagination(500)" [ngClass]="{'bg-count': filters.itemsPerPage == 500 }">500</p>
          </div>
      </div>

  </div>
</section>

<ng-template #dispatchTemp let-modal>
    <div class="modal-header">
        <h5 id="modal-basic-title">Dispatch Info</h5>
        <button type="button" class="close" aria-label="Close" (click)="modal.close()">
      <span aria-hidden="true">&times;</span>
    </button>
    </div>
    <div class="modal-body">
        <form #form="ngForm" (ngSubmit)="dispatchFormAdd(form,modal)">

            <div class="form-group">
                <label for="courier_service">Courier Service Name</label>
                <input type="text" class="form-control bg-input" id="courier_service" name="courier_service" [(ngModel)]="dispatchInfo.courier_service " #courier_service="ngModel" [disabled]="dispatchInfo?.name" required>
                <small class="text-danger" *ngIf="courier_service.invalid && form.submitted">* Required</small>
            </div>
            <div class="form-group">
                <label for="tracking_id">Tracking Id</label>
                <input type="text" class="form-control bg-input" id="tracking_id" name="tracking_id" [(ngModel)]="dispatchInfo.tracking_id " #tracking_id="ngModel" [disabled]="dispatchInfo?.name" required>
                <small class="text-danger" *ngIf="tracking_id.invalid && form.submitted">* Required</small>
            </div>
            <!-- <div class="form-group">
                <input type="text" appMatInput class="form-control" id="template_name" name="template_name" [(ngModel)]="emailTempData.name" #template_name="ngModel" required>
                <label for="GuestName" >Email Template</label>
            </div> -->
            <div class="form-group">
                <label for="dispatch_date">Dispatch Date</label>
                <input class="form-control h-auto bg-input" id="dispatch_date" name="dispatch_date" #dispatch_date="ngModel" [(ngModel)]="dispatchInfo.dispatch_date" [owlDateTime]="dt1" [owlDateTimeTrigger]="dt1" placeholder="dd/mm/yyyy" [min]="minDispatchDate" [disabled]="dispatchInfo?.name" required>
                <owl-date-time [pickerType]="'calendar'" #dt1></owl-date-time>
                <small class="text-danger" *ngIf="dispatch_date.invalid && form.submitted">* Required</small>
            </div>

            <div class="mt-3 text-right">
                <button class="btn btn-primary btn-sm" type="submit" *ngIf="!dispatchInfo?.name" >Add</button>
                <!-- <button class="btn btn-primary btn-sm" type="button" *ngIf="dispatchInfo?.name" (click)="dispatchFormEdit(form,modal)">Save</button> -->
            </div>
        </form>
    </div>
</ng-template>
<ng-template #emailLog let-modal>
  <div class="modal-header">
      <h5 id="modal-basic-title">Email Log</h5>
      <button type="button" class="close" aria-label="Close" (click)="modal.close()">
    <span aria-hidden="true">&times;</span>
  </button>
  </div>
  <div class="modal-body px-0">
      <div class="activity-feed">
          <div class="feed-item" *ngFor="let item of emailLogs;let index=index">
              <ng-container>


                  <ul class="timeline pb-2" *ngFor="let emails of item.emails">
                    <ng-container >
                      <li >
                        <p class="m-0 font-weight-bold">{{emails}}</p>
                        <p>{{item.creation |date:["MMM d y h:mm a"]}}</p>
                        <hr>
                     </li>
                    </ng-container>



                  </ul>

              </ng-container>
          </div>

      </div>
  </div>
</ng-template>

</div>
