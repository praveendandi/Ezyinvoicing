<div class="bg-primary py-3 pb-5">
    <div class="container-fluid px-5">
        <div class="row">
            <div class="col-md-6">
                <h5 class="text-white"><span><img (click)="gotoBack()" class="img-fluid icon-img" src="../../../assets/images/back.png" alt=""></span>
                    <span class="pl-3"> <span>B2B Invoices</span> <span class="px-2"> | </span><b><small>GSTR2</small></b></span>
                </h5>
            </div>

            <div class="col-md-6">
                <div class="text-right">
                    <p class="m-0 text-white"><span><b>Last edit on :</b></span> {{b2bInvoicesData?.last_modified_date | date:'medium'}}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<section class="position-relative top-10">
    <div class="container-fluid px-5">
        <div class="row">
            <div class="col-md-12">
                <div class="card  c-border shadow-sm ">
                    <div class="card-body invoice-total p-0">
                        <div>
                            <div class="row no-gutters">
                                <div class="col p-3">
                                    <h4><b>{{b2bInvoicesData?.invoice_count || 0}}</b></h4>
                                    <p>No of Invoices</p>
                                </div>
                                <div class="col p-3">
                                    <h4><b>{{b2bInvoicesData?.total_taxable_value || 0}}</b></h4>
                                    <p>Total Taxable value</p>
                                </div>
                                <div class="col p-3 text-center">
                                    <h4><b>{{b2bInvoicesData?.igst || 0}}</b></h4>
                                    <p>IGST</p>
                                </div>
                                <div class="col p-3 text-center">
                                    <h4><b>{{b2bInvoicesData?.cgst || 0}}</b></h4>
                                    <p>CGST</p>
                                </div>
                                <div class="col p-3 text-center">
                                    <h4><b>{{b2bInvoicesData?.sgst || 0}}</b></h4>
                                    <p>SGST</p>
                                </div>
                                <div class="col p-3 text-center">
                                    <h4><b>{{b2bInvoicesData?.cess || 0}}</b></h4>
                                    <p>CESS</p>
                                </div>

                            </div>
                            <!-- <div class="text-right px-2">
                                <a class="position-relative view-details top-5">View Details</a>
                            </div> -->
                        </div>
                    </div>
                </div>

            </div>
        </div>



        <div class="row py-3">
            <div class="col-md-2">
                <div>
                    <select class="custom-select" name="legal_name" [(ngModel)]="filters.legal_name" (ngModelChange)="updateRouterParams()" id="legal_name">
                        <option [value]="'All'" >All Suppliers</option>
                        <option *ngFor="let item of allSuppliersList" [value]="item.legal_name" >{{item.legal_name}}</option>
                  </select>
                </div>
                <!-- <div ngbDropdown class="d-inline-block c-border">
                    <button class="btn bg-white shadow-sm  d-block px-5" id="dropdownBasic1" ngbDropdownToggle>{{filters.search.legal_name || 'All Suppliers'}}</button>
                    <div class="c-border sahdow-sm" ngbDropdownMenu aria-labelledby="dropdownBasic1">
                        <button ngbDropdownItem *ngFor="let item of allSuppliersList" (click)="selectSupplier(item)">{{item.legal_name}}</button>
                    </div>
                </div> -->
            </div>


            <div class="col-md-5">

            </div>



            <div class="col-md-3">
                <div>
                    <input type="search" class="form-control br-0 c-border shadow-sm" placeholder="Search by invoice number" #invoice_number [(ngModel)]="filters.invoice_number" (keyup)="onSearch.emit(filters)" (search)="onSearch.emit(filters)" (keyup.enter)="updateRouterParams()">
                </div>
            </div>

            <div class="col-md-2 text-right">
                <!-- <button type="submit" class="btn bg-white c-border shadow-sm">Download</button> -->
                <!-- <button type="submit" class="btn bg-white c-border shadow-sm mx-3">Add Invoice</button> -->
                <button type="button" (click)="uploadExcelFile(uploadExcel)" class="btn btn-secondary">Upload Excel</button>

            </div>

        </div>


        <div class="row">
            <div class="col-md-12">
                <div class="c-border border-top-0">
                    <table class="table table-responsive table-bordered">
                        <thead class="bg-light">
                            <tr>
                                <th>GSTIN of Supplier</th>
                                <th>Legal Name Supplier</th>
                                <th>HSN/SAC Code</th>
                                <th>Description</th>
                                <th>Invoice Number</th>
                                <th>Invoice Type</th>
                                <th>Invoice Date</th>
                                <th>Invoice Value</th>
                                <th>Place of Supply</th>
                                <th>Supply Attract Reverse Charge</th>
                                <th>Tax Rate</th>
                                <th>Taxable Value</th>
                                <th>Integrated Tax</th>
                                <th>State Tax</th>
                                <th>Central Tax</th>
                                <th>Cess</th>
                                <th>Total Tax amount</th>
                                <!-- <th>Actions</th> -->
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let item of gstr2AList">
                                <td>{{item?.gstin}}</td>
                                <td>{{item?.legal_name}}</td>
                                <td>{{'NA'}}</td>
                                <td></td>
                                <td>{{item?.invoice_number}}</td>
                                <td>{{item?.invoice_type}}</td>
                                <td>{{item?.invoice_date}}</td>
                                <td>{{item?.invoice_value}}</td>
                                <td>{{item?.place_of_supply}}</td>
                                <td>{{item?.supply_attract_reverse_charge}}</td>
                                <td class="text-right">{{item?.tax_rate}}</td>
                                <td class="text-right">{{item?.taxable_value}}</td>
                                <td class="text-right">{{item?.igst}}</td>
                                <td class="text-right">{{item?.sgst}}</td>
                                <td class="text-right">{{item?.cgst}}</td>
                                <td class="text-right">{{item?.cess}}</td>
                                <td class="text-right">{{'NA'}}</td>
                                <!-- <td>
                                    <button class="btn btn-light py-0 bg-white shadow-sm c-border mr-1" type="button" (click)="addEditInvoice('Edit')">Edit</button>
                                    <button class="btn btn-light py-0 bg-white shadow-sm c-border" type="button">Delete</button>
                                </td> -->
                            </tr>
                        </tbody>
                    </table>

                    <div class="d-flex justify-content-between" *ngIf="gstr2AList.length">
                        <div class="px-3">
                            <select class="custom-select" name="itemsPerPage" [(ngModel)]="filters.itemsPerPage" (change)="checkPagination()" id="itemsPerPage">
                        <option [value]="20">20</option>
                        <option [value]="50">50</option>
                        <option [value]="100">100</option>
                        <option [value]="150">150</option>
                        <option [value]="500">500</option>
                      </select>
                        </div>
                        <div *ngIf="gstr2AList.length  < this.filters.totalCount">
                            <p class="text-right pr-5 more text-primary" (click)="this.filters.start = gstr2AList.length;this.filters.currentPage = this.filters.currentPage+1;  updateRouterParams()">
                                more
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>



    </div>
</section>

<ng-template #uploadExcel let-modal>
    <div>
        <div class="modal-header">
            <h5 class="" id="modal-basic-title">Column Mapping</h5>
            <button type="button" class="btn btn-secondary" *ngIf="xcelModal.showMappedBtnTh" (click)="resetbtn()">Reset</button>
            <button type="button" class="close" aria-label="Close" (click)="modal.dismiss('Cross click')">
        <span aria-hidden="true">&times;</span>
      </button>
        </div>

        <div class="cardMaxHght">
            <div class="file-upload p-5" *ngIf="!xcelModal.uploadedFileData">
                <div *ngIf="!filename">
                    <label for="file" class="d-block cursor-pointer text-center">
                  <i class="ri-upload-cloud-line"></i>
                  <h6><strong>Upload File</strong></h6>
                </label>
                    <input accept=".xlsx" (change)="handleFileInput($event)" class="opacity-0" type="file" name="" id="file">
                </div>

                <div class="text-center" *ngIf="filename">
                    <i class="ri-file-text-line text-success line-height-0"></i>
                    <div class="my-3">{{filename}}</div>
                </div>
            </div>
            <div class="row " *ngIf="xcelModal.uploadedFileData">
                <!-- <form> -->
                <div class="col-md-12">
                    <div class="c-border border-top-0 ">
                        <table class="table  table-bordered">
                            <thead class="bg-light">
                                <tr>
                                    <!-- <th *ngFor="let th of thValues; let i = index">
                                        <div ngbDropdown class="d-inline-block c-border" container="body">
                                            <button class="btn bg-white shadow-sm  d-block px-3" [id]="i" ngbDropdownToggle>{{'Not Mapped'}}</button>
                                            <div class="c-border shadow-sm dropdownDiv" ngbDropdownMenu>
                                                <button ngbDropdownItem *ngFor="let item of gstr2XcelTableHeadings;let index = index" (click)="selectedITem(item,i)">{{item.value}}</button>
                                            </div>
                                        </div>
                                    </th> -->
                                    <th *ngFor="let th of tableArrs.gstr2XcelTableHeadings; let i = index">
                                        <button class="btn bg-white shadow-sm  d-block px-3" [id]="i" *ngIf="xcelModal.showMappedBtnTh">{{th.mappedHead || 'Not Mapped'}}</button>
                                        <div ngbDropdown *ngIf="!xcelModal.showMappedBtnTh" class="d-inline-block c-border" container="body">
                                            <button class="btn bg-white shadow-sm  d-block px-3" [id]="i" ngbDropdownToggle>{{th.mappedHead || 'Not Mapped'}}</button>
                                            <div class="c-border shadow-sm dropdownDiv" ngbDropdownMenu>
                                                <button ngbDropdownItem [disabled]="item.selected" *ngFor="let item of tableArrs.thValues;let index = index" (click)="selectedITem(item,th,i)"><span>{{item.label}}</span></button>
                                            </div>
                                        </div>
                                    </th>
                                </tr>
                                <tr>
                                    <th *ngFor="let th of tableArrs.gstr2XcelTableHeadings">{{th.value}}</th>
                                    <!-- <th *ngFor="let th of thValues">{{th.label}}</th> -->
                                </tr>

                            </thead>
                            <tbody>
                                <tr *ngFor="let item of tableArrs.gstr2XcelList">
                                    <td *ngFor="let col of tableArrs.gstr2XcelTableHeadings">{{item[col.value]}}</td>

                                    <!-- <td>{{item["Trade/Legal name of the Supplier"]}}</td>
                                    <td>{{item["Invoice number"]}}</td>
                                    <td>{{item["Invoice type"]}}</td>
                                    <td>{{item["Invoice Date"]}}</td>
                                    <td>{{item["Invoice Value (₹)"]}}</td>
                                    <td>{{item["Place of supply"]}}</td>
                                    <td>{{item["Supply Attract Reverse Charge"]}}</td>
                                    <td>{{item["Rate (%)"]}}</td>
                                    <td>{{item["Invoice Value (₹)"]}}</td>
                                    <td class="text-right">5,000</td>
                                    <td class="text-right">5,000</td>
                                    <td class="text-right">5,000</td>
                                    <td class="text-right">5,000</td>
                                    <td class="text-right">5,000</td> -->

                                </tr>


                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- </form> -->
            </div>
        </div>
        <div class="modal-footer">
            <button type="reset" class="btn btn-outline-dark" (click)="modalCancel('Save click')">Cancel</button>
            <button type="button" class="btn btn-secondary" *ngIf="!xcelModal.mappedBtn" (click)="uploadService()">Upload</button>
            <button type="button" class="btn btn-secondary" *ngIf="xcelModal.mappedBtn" (click)="submitMappedData()">Submit</button>
        </div>
    </div>
</ng-template>