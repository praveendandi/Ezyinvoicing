<section class="invoice position-relative">
  <div class="d-flex mb-3">
    <h4 class="text-white"><b>Credit Notes <small>({{this.filters.totalCount}})</small></b></h4>
    <div class="form-group w-c-50">
      <select id="my-select" [(ngModel)]="filters.search.filterBy" (ngModelChange)="onDateFilterChange()"
        class="custom-select" name="">
        <option value="All">All</option>
        <option value="Today">Today</option>
        <option value="Yesterday">Yesterday</option>
        <option value="This Week">This Week</option>
        <option value="Last Week">Last Week</option>
        <option value="This Month">This Month</option>
        <option value="Last Month">Last Month</option>
        <option value="This Year">This Year</option>
        <option value="Custom">Custom</option>
      </select>
    </div>

    <div class="form-group calendar w-c-50 position-relative" *ngIf="filters.search.filterBy == 'Custom'">
      <input class="form-control h-auto" [(ngModel)]="filters.search.filterDate" (dateTimeChange)="updateRouterParams()"
        [owlDateTime]="dt1" [selectMode]="'range'" [owlDateTimeTrigger]="dt1" placeholder="Date Time">
      <span class="example-trigger" [owlDateTimeTrigger]="dt1">
        <i class="ri-calendar-2-line"></i>
      </span>
      <owl-date-time [pickerType]="'calendar'" #dt1></owl-date-time>
    </div>
    <!-- <div class="text-right">
      <button (click)="synctoGST()" *ngIf="companyDetails?.ezy_gst_module == 1" class="btn btn-primary btn-small mx-2 btn-right" ngbTooltip="sync to gst"
          appPermissionButton accessType="write" type="button">Sync to GST</button>
    </div> -->
  </div>
  <div class="card border-0 shadow">
    <div class="card-body p-0">
      <virtual-scroller #scroll [items]="invoicesList">
      <div class="table-responsive">
        <table class="table table-bordered">
          <thead #head>
            <tr>
              <th>#</th>
              <th>
                <span><i (click)="sortBy('invoice_number','asc')" class="ri-arrow-up-line "
                    [ngClass]="{'colorBg':this.filters.search.orderBy== 'asc' && this.filters.search.sortBy == 'invoice_number'}"></i></span>
                <span><i (click)="sortBy('invoice_number','desc')" class="ri-arrow-down-line "
                    [ngClass]="{'colorBg':this.filters.search.orderBy== 'desc' && this.filters.search.sortBy == 'invoice_number' }"></i></span>
                Invoice Number
              </th>
              <th>
                <span><i (click)="sortBy('legal_name','asc')" class="ri-arrow-up-line"
                    [ngClass]="{'colorBg':this.filters.search.orderBy== 'asc' && this.filters.search.sortBy == 'legal_name'}"></i></span>
                <span><i (click)="sortBy('legal_name','desc')" class="ri-arrow-down-line"
                    [ngClass]="{'colorBg':this.filters.search.orderBy== 'desc' && this.filters.search.sortBy == 'legal_name'}"></i></span>
                Legal Name
              </th>
              <th>
                <span><i (click)="sortBy('confirmation_number','asc')" class="ri-arrow-up-line"
                    [ngClass]="{'colorBg':this.filters.search.orderBy== 'asc' && this.filters.search.sortBy == 'confirmation_number'}"></i></span>
                <span><i (click)="sortBy('confirmation_number','desc')" class="ri-arrow-down-line"
                    [ngClass]="{'colorBg':this.filters.search.orderBy== 'desc' && this.filters.search.sortBy == 'confirmation_number'}"></i></span>
                Confirmation No.
              </th>
              <th>GST No.</th>
              <th>
                <span><i (click)="sortBy('room_number','asc')" class="ri-arrow-up-line"
                    [ngClass]="{'colorBg':this.filters.search.orderBy== 'asc' && this.filters.search.sortBy == 'room_number'}"></i></span>
                <span><i (click)="sortBy('room_number','desc')" class="ri-arrow-down-line"
                    [ngClass]="{'colorBg':this.filters.search.orderBy== 'desc' && this.filters.search.sortBy == 'room_number'}"></i></span>
                Room No.
              </th>
              <th>Invoice Type</th>
              <th>IRN Generated</th>
              <th><span><i (click)="sortBy('creation','asc')" class="ri-arrow-up-line"
                    [ngClass]="{'colorBg':this.filters.search.orderBy== 'asc' && this.filters.search.sortBy == 'creation'}"></i></span>
                <span><i (click)="sortBy('creation','desc')" class="ri-arrow-down-line"
                    [ngClass]="{'colorBg':this.filters.search.orderBy== 'desc' && this.filters.search.sortBy == 'creation'}"></i></span>
                Date
              </th>
              <th *ngIf="companyDetails?.ezy_gst_module == 1">Sync Status</th>
              <th *ngIf="companyDetails?.ezy_gst_module == 1">Sync Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody #container>
            <tr>
              <td></td>
              <td>
                <div class="input-group input-group-sm">
                  <div class="input-group-prepend">
                    <span class="input-group-text">
                      <i class="ri-search-line"></i>
                    </span>
                  </div>
                  <input #invoiceInp type="search" [(ngModel)]="filters.search.invoice" (keyup)="onSearch.emit(filters)"
                    (keyup.enter)="updateRouterParams()" (search)="onSearch.emit(filters)" class="form-control">
                </div>
              </td>
              <td>
                <div class="input-group input-group-sm">
                  <div class="input-group-prepend">
                    <span class="input-group-text">
                      <i class="ri-search-line"></i>
                    </span>
                  </div>
                  <input #nameInp type="search" [(ngModel)]="filters.search.name" (keyup)="onSearch.emit(filters)"
                    (keyup.enter)="updateRouterParams()" (search)="onSearch.emit(filters)" class="form-control">
                </div>
              </td>
              <td>
                <div class="input-group input-group-sm">
                  <div class="input-group-prepend">
                    <span class="input-group-text">
                      <i class="ri-search-line"></i>
                    </span>
                  </div>
                  <input #confirmNumInp type="search" [(ngModel)]="filters.search.confirmation"
                    (keyup.enter)="updateRouterParams()" (keyup)="onSearch.emit(filters)"
                    (search)="onSearch.emit(filters)" class="form-control">
                </div>
              </td>
              <td>
                <div class="input-group input-group-sm">
                  <div class="input-group-prepend">
                    <span class="input-group-text">
                      <i class="ri-search-line"></i>
                    </span>
                  </div>
                  <input #gstNumInp type="search" [(ngModel)]="filters.search.gstNumber"
                    (keyup)="onSearch.emit(filters)" (keyup.enter)="updateRouterParams()"
                    (search)="onSearch.emit(filters)" class="form-control">
                </div>
              </td>
              <td>
                <div class="input-group input-group-sm">
                  <div class="input-group-prepend">
                    <span class="input-group-text">
                      <i class="ri-search-line"></i>
                    </span>
                  </div>
                  <input #roomNumInp type="search" [(ngModel)]="filters.search.roomNo" (keyup)="onSearch.emit(filters)"
                    (keyup.enter)="updateRouterParams()" (search)="onSearch.emit(filters)" class="form-control">
                </div>
              </td>
              <td>
                <div class="form-group">
                  <select id="invoiceType" class="custom-select" [(ngModel)]="filters.search.invoiceType"
                    (change)="onSearch.emit(filters)">
                    <option value="">Showing all</option>
                    <option value="B2B">B2B</option>
                    <option value="B2C">B2C</option>
                  </select>
                </div>
              </td>
              <td>
                <div class="form-group">
                  <select id="irn" class="custom-select" [(ngModel)]="filters.search.irn"
                    (change)="onSearch.emit(filters)">
                    <option value="">Showing all</option>
                    <option value="Pending">Pending</option>
                    <option value="Success">Success</option>
                    <option value="Cancelled">Cancelled</option>
                    <option value="Error">Error</option>
                  </select>
                </div>
              </td>
              <td>
                <!-- <div class="form-group">
                  <select id="sortBy" class="custom-select" [(ngModel)]="filters.search.sortBy"
                    (change)="onSearch.emit(filters)">
                    <option *ngFor="let sort of sortingList" [value]="sort.value">{{sort.name}}</option>
                  </select>
                </div> -->
              </td>
              <td *ngIf="companyDetails?.ezy_gst_module == 1">
                <div class="form-group">
                  <select id="synced_to_erp" class="custom-select" [(ngModel)]="filters.search.synced_to_erp" (change)="onSearch.emit(filters)">
                      <option value="">Showing all</option>
                      <option value="1">Synced</option>
                      <option value="0">Not Synced</option>
                  </select>
                </div>
              </td>
              <td *ngIf="companyDetails?.ezy_gst_module == 1"></td>
              <td></td>
            </tr>
            <tr *ngFor="let invoice of invoicesList;let i = index">
              <!-- <td>{{(this.filters.itemsPerPage * (this.filters.currentPage - 1) + i)+1 }}</td> -->
              <td>{{i+1}}</td>
              <td>{{invoice.invoice_number ||'NA'}} <i
                  *ngIf="invoice.ready_to_generate_irn == 'No'&& invoice.irn_generated =='Error'"
                  class="ri-error-warning-fill text-danger"></i>
              </td>
              <td>{{invoice.legal_name || 'NA'}}</td>
              <td>{{invoice.confirmation_number || 'NA'}}</td>
              <td>{{invoice.gst_number || 'NA'}}</td>
              <td>{{invoice.room_number|| 'NA'}}</td>
              <td>{{invoice.invoice_type|| 'NA'}}</td>
              <td class="text-left"><span class="badge"
                  [ngClass]="{'badge-success': invoice.irn_generated == 'Success','badge-warning':invoice.irn_generated == 'Pending','badge-default':invoice.irn_generated == 'Cancelled', 'badge-danger':invoice.irn_generated == 'Error'}">{{invoice.irn_generated}}</span>
              </td>
              <td>{{invoice.creation|date:'mediumDate'}}</td>
              <td *ngIf="companyDetails?.ezy_gst_module == 1">{{invoice?.synced_to_erp?'Synced':'Not Synced'}}</td>
              <td *ngIf="companyDetails?.ezy_gst_module == 1">{{invoice?.synced_date|date : ["MMM d y h:mm a"]}}</td>
              <td><span [routerLink]="['../../invoice-details/'+invoice.name]" [queryParams]="{prop:'credit'}"
                  queryParamsHandling="merge" appPermissionButton accessType="read" moduleType="docType"
                  class="view">View</span>
                <span (click)="print(invoice)" appPermissionButton accessType="print" moduleType="docType"
                  class="view pl-2">Print</span>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="text-center py-3" *ngIf="!invoicesList.length">
        <h4>No Data Found</h4>
      </div>
    </virtual-scroller>
      <div class="d-flex justify-content-between" *ngIf="invoicesList.length">
        <div class="px-3">
          <select class="custom-select" name="itemsPerPage" [(ngModel)]="filters.itemsPerPage"
            (change)="checkPagination()" id="itemsPerPage">
            <option [value]="20">20</option>
            <option [value]="50">50</option>
            <option [value]="100">100</option>
            <option [value]="150">150</option>
            <option [value]="500">500</option>
          </select>
        </div>
        <div *ngIf="invoicesList.length  < this.filters.totalCount">
          <p class="text-right pr-5 more text-primary"
            (click)="this.filters.start = invoicesList.length;this.filters.currentPage = this.filters.currentPage+1;  updateRouterParams()">
            more
          </p>
        </div>
      </div>

      <!-- <div class="d-flex justify-content-between" *ngIf="invoicesList.length">
        <div>
          <select class="custom-select px-3" name="itemsPerPage" [(ngModel)]="filters.itemsPerPage"
            (change)="checkPagination()" id="itemsPerPage">
            <option [value]="20">20</option>
            <option [value]="50">50</option>
            <option [value]="100">100</option>
            <option [value]="150">150</option>
            <option [value]="500">500</option>
          </select>
        </div>
        <pagination-controls (pageChange)="this.filters.currentPage = $event;updateRouterParams()" class="text-right">
        </pagination-controls>
      </div> -->
    </div>
  </div>
</section>

<!-- <ng-template #content let-c="close" let-d="dismiss">
  <div class="modal-header">
      <span class="modal-title" id="modal-basic-title">Syncing Documents</span>
      <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
          <i class="ri-close-line"></i>
      </button>
  </div>
  <div class="modal-body p-3">
      <div class="row">
          <div class="col-md-6">
            <div class="form-group ml-2 w-c-50 my-auto" *ngIf="!showList">
              <select id="my-select" [(ngModel)]="selectedMonth"  class="custom-select bg-white" name="selectedMonth">
                  <option value="Jan">January</option>
                  <option value="Feb">February</option>
                  <option value="Mar">March</option>
                  <option value="Apr">April</option>
                  <option value="May">May</option>
                  <option value="Jun">June</option>
                  <option value="Jul">July</option>
                  <option value="Aug">August</option>
                  <option value="Sep">September</option>
                  <option value="Oct">October</option>
                  <option value="Nov">November</option>
                  <option value="Dec">December</option>
              </select>

            </div>
          </div>
          <div class="col-md-6">
            <div class="form-group ml-2 w-c-50 my-auto" *ngIf="!showList">
              <select id="my-select" [(ngModel)]="selectedyear" class="custom-select bg-white" name="">
                <option *ngFor="let item of years" [value]="item">{{item}}</option>
            </select>
            </div>
          </div>
      </div>
  </div>
    <div class="modal-footer">
      <button type="button" class="btn btn-primary" (click)="synctoGST()">Sync</button>
  </div>
</ng-template> -->