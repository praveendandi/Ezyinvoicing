(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{MgRC:function(e,s,t){"use strict";t.d(s,"a",(function(){return n})),t.d(s,"b",(function(){return i}));var r=t("fXoL"),c=t("kmKP");let n=(()=>{class e{constructor(e,s){this.elementRef=e,this.userService=s,this.permissions={}}ngOnInit(){this.checkDocLevelAccess()}checkAccess(){this.userService.currentUser.subscribe(e=>{var s,t;if(null===(s=null==e?void 0:e.docinfo)||void 0===s?void 0:s.permissions){let s=null===(t=null==e?void 0:e.docinfo)||void 0===t?void 0:t.permissions;s.hasOwnProperty(this.accessType)&&(this.elementRef.nativeElement.disabled=!(s[this.accessType]>0))}})}checkDocLevelAccess(){var e;this.permissions=JSON.parse(localStorage.getItem("checkPermissions")),(null===(e=this.permissions)||void 0===e?void 0:e.hasOwnProperty(this.accessType))&&(this.elementRef.nativeElement.style["pointer-events"]=this.permissions[this.accessType]>0?"auto":"none",this.elementRef.nativeElement.style.cursor=this.permissions[this.accessType]>0?"pointer":"not-allowed",this.elementRef.nativeElement.disabled=!(this.permissions[this.accessType]>0))}}return e.\u0275fac=function(s){return new(s||e)(r.bc(r.o),r.bc(c.a))},e.\u0275dir=r.Wb({type:e,selectors:[["","appPermissionButton",""]],inputs:{moduleType:"moduleType",accessType:"accessType"}}),e})(),i=(()=>{class e{}return e.\u0275mod=r.Zb({type:e}),e.\u0275inj=r.Yb({factory:function(s){return new(s||e)}}),e})()},sRzU:function(e,s,t){"use strict";t.r(s),t.d(s,"UserDetailsModule",(function(){return R}));var r=t("ofXK"),c=t("tyNb"),n=t("t0ZU"),i=t("fXoL"),a=t("tk/3"),l=t("5eHb"),o=t("3Pt+"),u=t("HgEw"),d=t("ZOsW"),m=t("MgRC"),h=t("BcJq");function g(e,s){1&e&&(i.hc(0,"small",21),i.cd(1,"Required"),i.gc())}function p(e,s){if(1&e&&(i.hc(0,"ng-option",22),i.cd(1),i.gc()),2&e){const e=s.$implicit;i.Ec("value",e),i.Nb(1),i.dd(e)}}function f(e,s){1&e&&(i.hc(0,"small",21),i.cd(1,"Required"),i.gc())}const b=function(){return["/home/users"]};function v(e,s){if(1&e){const e=i.ic();i.hc(0,"section"),i.hc(1,"div",1),i.hc(2,"div",2),i.hc(3,"h4",3),i.cd(4,"User"),i.gc(),i.hc(5,"p",4),i.hc(6,"a",5),i.cd(7,"Users"),i.gc(),i.cd(8,"/ Edit USer "),i.gc(),i.hc(9,"form",null,6),i.hc(11,"div",7),i.hc(12,"div",8),i.hc(13,"div",7),i.hc(14,"div",9),i.hc(15,"div",10),i.hc(16,"input",11,12),i.sc("ngModelChange",(function(s){return i.Qc(e),i.wc().userDetails.first_name=s})),i.gc(),i.hc(18,"label",13),i.cd(19,"First Name *"),i.gc(),i.ad(20,g,2,0,"small",14),i.gc(),i.gc(),i.hc(21,"div",9),i.hc(22,"div"),i.hc(23,"ng-select",15,16),i.sc("ngModelChange",(function(s){return i.Qc(e),i.wc().userDetails.roles=s})),i.ad(25,p,2,2,"ng-option",17),i.gc(),i.ad(26,f,2,0,"small",14),i.gc(),i.gc(),i.gc(),i.hc(27,"div",18),i.hc(28,"button",19),i.cd(29,"Cancel"),i.gc(),i.hc(30,"button",20),i.sc("click",(function(){i.Qc(e);const s=i.Oc(10);return i.wc().onSubmit(s)})),i.cd(31,"Save"),i.gc(),i.gc(),i.gc(),i.gc(),i.gc(),i.gc(),i.gc(),i.gc()}if(2&e){const e=i.Oc(10),s=i.Oc(17),t=i.Oc(24),r=i.wc();i.Nb(6),i.Ec("routerLink",i.Hc(10,b))("queryParamsHandling","preserve")("replaceUrl",!0),i.Nb(10),i.Ec("ngModel",r.userDetails.first_name)("readonly","edit"===(null==r.paramsData?null:r.paramsData.type)),i.Nb(4),i.Ec("ngIf",e.submitted&&(null==s||null==s.errors?null:s.errors.required)),i.Nb(3),i.Ec("ngModel",r.userDetails.roles),i.Nb(2),i.Ec("ngForOf",r.roleList),i.Nb(1),i.Ec("ngIf",e.submitted&&(null==t||null==t.errors?null:t.errors.required)),i.Nb(2),i.Ec("routerLink",i.Hc(11,b))}}function y(e,s){1&e&&(i.hc(0,"small",21),i.cd(1,"Required"),i.gc())}function w(e,s){1&e&&(i.hc(0,"small",21),i.cd(1,"Required"),i.gc())}function N(e,s){1&e&&(i.hc(0,"small",21),i.cd(1,"Already Exists"),i.gc())}function D(e,s){1&e&&(i.hc(0,"small",21),i.cd(1,"Required"),i.gc())}function E(e,s){1&e&&(i.hc(0,"small",21),i.cd(1,"Check password pattern"),i.gc())}function M(e,s){1&e&&(i.hc(0,"small",21),i.cd(1,"Required"),i.gc())}function k(e,s){1&e&&(i.hc(0,"small",21),i.cd(1,"password mismatch"),i.gc())}function U(e,s){if(1&e&&(i.hc(0,"ng-option",22),i.cd(1),i.gc()),2&e){const e=s.$implicit;i.Ec("value",e),i.Nb(1),i.dd(e)}}function _(e,s){1&e&&(i.hc(0,"small",21),i.cd(1,"Required"),i.gc())}function q(e,s){if(1&e){const e=i.ic();i.hc(0,"section"),i.hc(1,"div",1),i.hc(2,"div",2),i.hc(3,"h4",3),i.cd(4,"User"),i.gc(),i.hc(5,"p",4),i.hc(6,"a",5),i.cd(7,"Users"),i.gc(),i.cd(8,"/ Create USer "),i.gc(),i.hc(9,"form",null,6),i.hc(11,"div",7),i.hc(12,"div",8),i.hc(13,"div",7),i.hc(14,"div",9),i.hc(15,"div",10),i.hc(16,"input",11,12),i.sc("ngModelChange",(function(s){return i.Qc(e),i.wc().userDetails.first_name=s})),i.gc(),i.hc(18,"label",13),i.cd(19,"First Name *"),i.gc(),i.ad(20,y,2,0,"small",14),i.gc(),i.gc(),i.hc(21,"div",9),i.hc(22,"div",10),i.hc(23,"input",23,24),i.sc("ngModelChange",(function(s){return i.Qc(e),i.wc().userDetails.username=s}))("ngModelChange",(function(s){return i.Qc(e),i.wc().checkUserName(s,"userName")})),i.gc(),i.hc(25,"label",25),i.cd(26,"UserName *"),i.gc(),i.ad(27,w,2,0,"small",14),i.ad(28,N,2,0,"small",14),i.gc(),i.gc(),i.hc(29,"div",9),i.hc(30,"div",10),i.hc(31,"input",26,27),i.sc("ngModelChange",(function(s){return i.Qc(e),i.wc().userDetails.new_password=s})),i.gc(),i.hc(33,"label",28),i.cd(34,"Password *"),i.gc(),i.hc(35,"small",29),i.hc(36,"b"),i.cd(37,"Note "),i.gc(),i.cd(38," : should contain special characters and alphanumeric with min 6 and max 20 characters"),i.gc(),i.cc(39,"br"),i.ad(40,D,2,0,"small",14),i.ad(41,E,2,0,"small",14),i.gc(),i.gc(),i.hc(42,"div",9),i.hc(43,"div",10),i.hc(44,"input",30,31),i.sc("ngModelChange",(function(s){return i.Qc(e),i.wc().userDetails.confirmPassword=s})),i.gc(),i.hc(46,"label",32),i.cd(47,"Confirm Password *"),i.gc(),i.ad(48,M,2,0,"small",14),i.ad(49,k,2,0,"small",14),i.gc(),i.gc(),i.hc(50,"div",9),i.hc(51,"div"),i.hc(52,"ng-select",15,16),i.sc("ngModelChange",(function(s){return i.Qc(e),i.wc().userDetails.roles=s})),i.ad(54,U,2,2,"ng-option",17),i.gc(),i.ad(55,_,2,0,"small",14),i.gc(),i.gc(),i.gc(),i.hc(56,"div",18),i.hc(57,"button",19),i.cd(58,"Cancel"),i.gc(),i.hc(59,"button",33),i.sc("click",(function(){i.Qc(e);const s=i.Oc(10);return i.wc().onSubmit(s)})),i.cd(60,"Save"),i.gc(),i.gc(),i.gc(),i.gc(),i.gc(),i.gc(),i.gc(),i.gc()}if(2&e){const e=i.Oc(10),s=i.Oc(17),t=i.Oc(24),r=i.Oc(32),c=i.Oc(45),n=i.Oc(53),a=i.wc();i.Nb(6),i.Ec("routerLink",i.Hc(20,b))("queryParamsHandling","preserve")("replaceUrl",!0),i.Nb(10),i.Ec("ngModel",a.userDetails.first_name)("readonly","edit"===(null==a.paramsData?null:a.paramsData.type)),i.Nb(4),i.Ec("ngIf",e.submitted&&(null==s||null==s.errors?null:s.errors.required)),i.Nb(3),i.Ec("ngModel",a.userDetails.username),i.Nb(4),i.Ec("ngIf",e.submitted&&(null==t||null==t.errors?null:t.errors.required)),i.Nb(1),i.Ec("ngIf",a.checkName),i.Nb(3),i.Ec("ngModel",a.userDetails.new_password),i.Nb(9),i.Ec("ngIf",e.submitted&&(null==r||null==r.errors?null:r.errors.required)),i.Nb(1),i.Ec("ngIf",e.submitted&&(null==r||null==r.errors?null:r.errors.pattern)),i.Nb(3),i.Ec("ngModel",a.userDetails.confirmPassword),i.Nb(4),i.Ec("ngIf",e.submitted&&(null==c||null==c.errors?null:c.errors.required)),i.Nb(1),i.Ec("ngIf",(null==c?null:c.value)&&(null==r?null:r.value)!==(null==c?null:c.value)),i.Nb(3),i.Ec("ngModel",a.userDetails.roles),i.Nb(2),i.Ec("ngForOf",a.roleList),i.Nb(1),i.Ec("ngIf",e.submitted&&(null==n||null==n.errors?null:n.errors.required)),i.Nb(2),i.Ec("routerLink",i.Hc(21,b)),i.Nb(2),i.Ec("disabled",a.checkName||(null==r?null:r.value)!==(null==c?null:c.value))}}const O=[{path:"",component:(()=>{class e{constructor(e,s,t,r){this.http=e,this.router=s,this.activateRoute=t,this.toaster=r,this.userDetails={},this.checkName=!1}ngOnInit(){var e,s;this.loginUser=JSON.parse(localStorage.getItem("login")),this.paramsData=this.activateRoute.snapshot.queryParams,this.getRoles(),(null===(e=this.paramsData)||void 0===e?void 0:e.id)&&(null===(s=this.paramsData)||void 0===s?void 0:s.type)&&this.getUserDetails()}getUserDetails(){this.http.get(`${n.a.users}/${this.paramsData.id}`).subscribe(e=>{this.userDetails=null==e?void 0:e.data,this.userDetails.roles=this.userDetails.roles.map(e=>e.role),this.userDetails.roles=this.userDetails.roles.filter(e=>e.includes("ezy-")),this.userDetails.roles=this.userDetails.roles[0]})}getRoles(){this.http.get(n.a.roles,{params:{limit_page_length:"None",fields:JSON.stringify(["name","role_name"]),filters:JSON.stringify([["role_name","like","%ezy-%"],["role_name","!=","ezy-Admin"],["disabled","!=","1"]])}}).subscribe(e=>{var s;this.roleList=null===(s=e.data)||void 0===s?void 0:s.map(e=>e.role_name)})}onSubmit(e){var s;let t=["EzyInvoicing"];if(t=t.concat(e.value.roles),e.valid){let r={docstatus:0,doctype:"Has Role",modified_by:this.loginUser.full_name,owner:this.loginUser.full_name,parent:e.value.username?e.value.username+"@ezyinvoicing.local":this.userDetails.email,parentfield:"roles",parenttype:"User",role:t},c={email:e.value.username?e.value.username+"@ezyinvoicing.local":this.userDetails.email,first_name:e.value.first_name,enabled:1,user_type:"System User",username:e.value.username?e.value.username:this.userDetails.username};(null===(s=this.paramsData)||void 0===s?void 0:s.id)?e.value.roles&&this.http.put(""+n.a.addUserRoles,r).subscribe(e=>{var s;(null===(s=e.message)||void 0===s?void 0:s.success)?(this.toaster.success("Updated"),this.router.navigate(["/home/users"])):this.toaster.error("Error")}):this.http.post(n.a.users,c).subscribe(s=>{console.log(s),e.value.new_password&&this.http.put(`${n.a.users}/${c.email}`,{new_password:e.value.new_password}).subscribe(e=>{e.data&&setTimeout(()=>{this.http.post(""+n.a.addUserRoles,r).subscribe(e=>{this.router.navigate(["/home/users"])})},1e3)})},e=>{409==e.status&&this.toaster.info("User Email is exists.")})}else e.form.markAllAsTouched()}checkUserName(e,s){let t="Email"==s?["email","=",e]:["username","=",e];this.http.get(""+n.a.users,{params:{fields:JSON.stringify(["*"]),filters:JSON.stringify([t])}}).subscribe(e=>{var t;0==(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.length)?"userName"==s&&(this.checkName=!1):"userName"==s&&(this.checkName=!0)})}}return e.\u0275fac=function(s){return new(s||e)(i.bc(a.b),i.bc(c.e),i.bc(c.a),i.bc(l.d))},e.\u0275cmp=i.Vb({type:e,selectors:[["app-user-details"]],decls:2,vars:2,consts:[[4,"ngIf"],[1,"card"],[1,"card-body"],[1,"font-weight-bold"],[1,"text-muted"],[1,"text-primary","cursor-pointer",3,"routerLink","queryParamsHandling","replaceUrl"],["form","ngForm"],[1,"row"],[1,"col-lg-10","col-md-10"],[1,"col-lg-6","col-md-6"],[1,"form-group"],["type","text","appMatInput","","id","first_name","name","first_name","required","",1,"form-control",3,"ngModel","readonly","ngModelChange"],["first_name","ngModel"],["for","first_name",1,"mat-label"],["class","text-danger",4,"ngIf"],["placeholder","select Role","name","roles","id","role","required","",1,"",3,"ngModel","ngModelChange"],["roles","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"text-right"],["type","button",1,"btn","btn-outline-primary","mb-0","text-uppercase",3,"routerLink"],["appPermissionButton","","accessType","write","type","submit",1,"btn","btn-primary","mb-0","text-uppercase","ml-3",3,"click"],[1,"text-danger"],[3,"value"],["appMatInput","","noWhiteSpace","","id","userName","type","text","name","username","required","",1,"form-control",3,"ngModel","ngModelChange"],["username","ngModel"],["for","userName",1,"mat-label"],["appMatInput","","id","newPassword","type","password","pattern","^(?=.*[A-Za-z])(?=.*\\d)(?=.*[@$!%*#?&])[A-Za-z\\d@$!%*#?&]{6,}$","name","new_password","required","",1,"form-control",3,"ngModel","ngModelChange"],["new_password","ngModel"],["for","newPassword",1,"mat-label"],[1,"text-mute"],["appMatInput","","id","confirmPassword","type","password","name","confirmPassword","required","",1,"form-control",3,"ngModel","ngModelChange"],["confirmPassword","ngModel"],["for","confirmPassword",1,"mat-label"],["appPermissionButton","","accessType","write","type","submit",1,"btn","btn-primary","mb-0","text-uppercase","ml-3",3,"disabled","click"]],template:function(e,s){1&e&&(i.ad(0,v,32,12,"section",0),i.ad(1,q,61,22,"section",0)),2&e&&(i.Ec("ngIf",s.paramsData.id),i.Nb(1),i.Ec("ngIf",!s.paramsData.id))},directives:[r.p,c.h,o.u,o.j,o.k,o.b,u.a,o.q,o.i,o.l,d.a,r.o,c.f,m.a,d.d,h.a,o.o],styles:[""]}),e})()}];let I=(()=>{class e{}return e.\u0275mod=i.Zb({type:e}),e.\u0275inj=i.Yb({factory:function(s){return new(s||e)},imports:[[c.i.forChild(O)],c.i]}),e})(),R=(()=>{class e{}return e.\u0275mod=i.Zb({type:e}),e.\u0275inj=i.Yb({factory:function(s){return new(s||e)},imports:[[r.c,I,o.d,m.b,u.b,d.b,h.b]]}),e})()}}]);