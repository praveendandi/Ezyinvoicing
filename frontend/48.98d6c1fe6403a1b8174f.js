(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{OGro:function(t,e,c){"use strict";c.r(e),c.d(e,"EmailLogsModule",(function(){return N}));var n=c("ofXK"),i=c("tyNb"),a=c("fXoL"),s=c("cp0P"),o=c("Kj3r"),r=c("eIep"),l=c("t0ZU"),g=c("AytR"),d=c("tk/3"),h=c("1kSV"),u=c("5eHb"),p=c("3Pt+"),f=c("SYYg");const b=function(){return["MMM d, y, h:mm a"]},m=function(t,e,c,n,i){return{"badge-success":t,"badge-warning":e,"badge-default":c,"badge-default":n,"badge-danger":i}};function P(t,e){if(1&t&&(a.hc(0,"tr"),a.hc(1,"td"),a.cd(2),a.gc(),a.hc(3,"td"),a.cd(4),a.gc(),a.hc(5,"td"),a.cd(6),a.gc(),a.hc(7,"td"),a.cd(8),a.xc(9,"date"),a.gc(),a.hc(10,"td"),a.cd(11),a.gc(),a.hc(12,"td"),a.hc(13,"span",21),a.cd(14),a.gc(),a.gc(),a.gc()),2&t){const t=e.$implicit;a.Nb(2),a.dd(t.index),a.Nb(2),a.dd(null==t?null:t.reference_name),a.Nb(2),a.dd(null==t?null:t.to),a.Nb(2),a.dd(a.zc(9,7,null==t?null:t.creation,a.Gc(10,b))),a.Nb(3),a.dd(null==t?null:t.modified_by),a.Nb(2),a.Dc("ngClass",a.Lc(11,m,"Sent"==t.status,"Sending"==t.status,"Not Sent"==t.status,"Expired"==t.status,"Error"==t.status)),a.Nb(1),a.ed(" ",null==t?null:t.status,"")}}function x(t,e){1&t&&(a.hc(0,"div",22),a.hc(1,"h5"),a.cd(2,"No Data Found"),a.gc(),a.gc())}function v(t,e){if(1&t){const t=a.ic();a.hc(0,"div"),a.hc(1,"p",28),a.sc("click",(function(){a.Pc(t);const e=a.wc(2);return e.filters.start=e.emailLogList.length,e.filters.currentPage=e.filters.currentPage+1,e.updateRouterParams()})),a.cd(2," more "),a.gc(),a.gc()}}function y(t,e){if(1&t){const t=a.ic();a.hc(0,"div",23),a.hc(1,"div",24),a.hc(2,"select",25),a.sc("ngModelChange",(function(e){return a.Pc(t),a.wc().filters.itemsPerPage=e}))("change",(function(){return a.Pc(t),a.wc().checkPagination()})),a.hc(3,"option",26),a.cd(4,"20"),a.gc(),a.hc(5,"option",26),a.cd(6,"50"),a.gc(),a.hc(7,"option",26),a.cd(8,"100"),a.gc(),a.hc(9,"option",26),a.cd(10,"150"),a.gc(),a.hc(11,"option",26),a.cd(12,"500"),a.gc(),a.gc(),a.gc(),a.ad(13,v,3,0,"div",27),a.gc()}if(2&t){const t=a.wc();a.Nb(2),a.Dc("ngModel",t.filters.itemsPerPage),a.Nb(1),a.Dc("value",20),a.Nb(2),a.Dc("value",50),a.Nb(2),a.Dc("value",100),a.Nb(2),a.Dc("value",150),a.Nb(2),a.Dc("value",500),a.Nb(2),a.Dc("ngIf",t.emailLogList.length<t.filters.totalCount)}}class C{constructor(){this.itemsPerPage=20,this.currentPage=1,this.totalCount=0,this.search=""}}const _=[{path:"",component:(()=>{class t{constructor(t,e,c,n,i){this.http=t,this.activatedRoute=e,this.router=c,this.modal=n,this.toastr=i,this.filters=new C,this.onSearch=new a.q,this.emailLogList=[],this.apiDomain=g.a.apiDomain}ngOnInit(){var t;this.companyDetails=JSON.parse(localStorage.getItem("company")),this.filters.itemsPerPage=null===(t=this.companyDetails)||void 0===t?void 0:t.items_per_page,this.onSearch.pipe(Object(o.a)(500)).subscribe(t=>this.updateRouterParams()),this.getTotalCount()}updateRouterParams(){this.router.navigate(["home/email-logs"],{queryParams:this.filters})}getTotalCount(){this.http.get(`${l.a.resource}/${l.b.emailLogs}`,{params:{fields:JSON.stringify(["count( `tabEmail Queue`.`name`) AS total_count"])}}).subscribe(t=>{this.filters.totalCount=t.data[0].total_count,this.getEmailLogList()})}getEmailLogList(){this.activatedRoute.queryParams.pipe(Object(r.a)(t=>{this.filters.totalCount=parseInt(t.totalCount,0)||this.filters.totalCount,this.filters.search=t.search||this.filters.search;const e={filters:[]};this.filters.search&&e.filters.push(["name","like",`%${this.filters.search}%`]),e.limit_page_length=this.filters.itemsPerPage,e.order_by="`tabEmail Queue`.`modified` desc",e.fields=JSON.stringify(["name","creation","modified","modified_by","sender","message","reference_doctype","reference_name","status"]),e.filters=JSON.stringify(e.filters);const c=this.http.get(`${l.a.resource}/${l.b.emailLogs}`,{params:{fields:JSON.stringify(["count( `tabEmail Queue`.`name`) AS total_count"]),filters:e.filters}}),n=this.http.get(`${l.a.resource}/${l.b.emailLogs}`,{params:e});return Object(s.a)([c,n])})).subscribe(t=>{1==this.filters.currentPage&&(this.emailLogList=[]);const[e,c]=t;c.data=c.data.map((t,e)=>(t&&(t.to=null==t?void 0:t.message.match(/(To: [a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi)[0].split("To: ")[1],t.index=this.emailLogList.length+e+1),t)),this.filters.totalCount=e.data[0].total_count,c.data&&(this.emailLogList=1!==this.filters.currentPage?this.emailLogList.concat(c.data):c.data)})}checkPagination(){this.filters.currentPage=1,this.updateRouterParams()}}return t.\u0275fac=function(e){return new(e||t)(a.bc(d.b),a.bc(i.a),a.bc(i.e),a.bc(h.k),a.bc(u.d))},t.\u0275cmp=a.Vb({type:t,selectors:[["app-email-logs"]],decls:39,vars:6,consts:[[1,"row","mb-3"],[1,"col-md-9","col-lg-9"],[1,"d-flex"],[1,"font-weight-bold","text-white"],[1,"col-lg-3","col-md-3"],[1,"position-relative","mt-2","mt-lg-0","mt-md-0"],["type","search","placeholder","Search by invoice number",1,"form-control","pl-5",3,"ngModel","ngModelChange","keyup","search"],["search",""],[1,"search"],[1,"ri-search-line"],[1,"card","pb-2"],[3,"items"],["scroll",""],[1,"table-responsive"],[1,"table"],[1,"thead"],["head",""],["container",""],[4,"ngFor","ngForOf"],["class","text-center py-3",4,"ngIf"],["class","d-flex pb-2 justify-content-between",4,"ngIf"],[1,"badge",3,"ngClass"],[1,"text-center","py-3"],[1,"d-flex","pb-2","justify-content-between"],[1,"px-3"],["name","itemsPerPage","id","itemsPerPage",1,"custom-select",3,"ngModel","ngModelChange","change"],[3,"value"],[4,"ngIf"],[1,"text-right","pr-5","more","text-primary",3,"click"]],template:function(t,e){if(1&t){const t=a.ic();a.hc(0,"section"),a.hc(1,"div",0),a.hc(2,"div",1),a.hc(3,"div",2),a.hc(4,"h4",3),a.cd(5,"Email Logs "),a.hc(6,"small"),a.cd(7),a.gc(),a.gc(),a.gc(),a.gc(),a.hc(8,"div",4),a.hc(9,"div",5),a.hc(10,"input",6,7),a.sc("ngModelChange",(function(t){return e.filters.search=t}))("keyup",(function(){a.Pc(t);const c=a.Nc(11);return e.filters.search=c.value,e.onSearch.emit(e.filters)}))("search",(function(){return e.onSearch.emit(e.filters)})),a.gc(),a.hc(12,"span",8),a.cc(13,"i",9),a.gc(),a.gc(),a.gc(),a.gc(),a.hc(14,"div",10),a.hc(15,"virtual-scroller",11,12),a.hc(17,"div",13),a.hc(18,"table",14),a.hc(19,"thead",15,16),a.hc(21,"tr"),a.hc(22,"th"),a.cd(23,"#"),a.gc(),a.hc(24,"th"),a.cd(25,"Invoice Number"),a.gc(),a.hc(26,"th"),a.cd(27,"Sent To"),a.gc(),a.hc(28,"th"),a.cd(29,"Sent At"),a.gc(),a.hc(30,"th"),a.cd(31,"Sent By"),a.gc(),a.hc(32,"th"),a.cd(33,"Status"),a.gc(),a.gc(),a.gc(),a.hc(34,"tbody",null,17),a.ad(36,P,15,17,"tr",18),a.gc(),a.gc(),a.ad(37,x,3,0,"div",19),a.gc(),a.gc(),a.ad(38,y,14,7,"div",20),a.gc(),a.gc()}if(2&t){const t=a.Nc(16);a.Nb(7),a.ed("(",e.filters.totalCount,")"),a.Nb(3),a.Dc("ngModel",e.filters.search),a.Nb(5),a.Dc("items",e.emailLogList),a.Nb(21),a.Dc("ngForOf",t.viewPortItems),a.Nb(1),a.Dc("ngIf",!e.emailLogList.length),a.Nb(1),a.Dc("ngIf",e.emailLogList.length)}},directives:[p.b,p.i,p.l,f.a,n.o,n.p,n.n,p.r,p.m,p.t],pipes:[n.f],styles:['.more[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:0;border-top:0;font-size:12px;padding:9px 10px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:9px 10px;font-size:14px;border:1px solid rgba(221,218,218,.3)}.badge-success[_ngcontent-%COMP%]{padding:6px 20px;border-radius:30px;margin:0 auto;text-align:center;background:transparent;font-size:12px;color:#000;position:relative}.badge-success[_ngcontent-%COMP%]:after{position:absolute;content:"";left:0;background:#0bd72e;width:10px;height:10px;border-radius:50%}.badge-warning[_ngcontent-%COMP%]{padding:6px 20px;border-radius:30px;margin:0 auto;text-align:center;background:transparent;font-size:12px;color:#000;position:relative}.badge-warning[_ngcontent-%COMP%]:after{position:absolute;content:"";left:0;background:#ffd00a;width:10px;height:10px;border-radius:50%}.badge-danger[_ngcontent-%COMP%]{padding:6px 20px;border-radius:30px;margin:0 auto;text-align:center;background:transparent;font-size:12px;color:#000;position:relative}.badge-danger[_ngcontent-%COMP%]:after{position:absolute;content:"";left:0;background:#ff2f0a;width:10px;height:10px;border-radius:50%}virtual-scroller[_ngcontent-%COMP%]{width:100%;height:500px}.custom-select[_ngcontent-%COMP%]{font-size:14px;height:32px;border:0}']}),t})()}];let L=(()=>{class t{}return t.\u0275mod=a.Zb({type:t}),t.\u0275inj=a.Yb({factory:function(e){return new(e||t)},imports:[[i.i.forChild(_)],i.i]}),t})(),N=(()=>{class t{}return t.\u0275mod=a.Zb({type:t}),t.\u0275inj=a.Yb({factory:function(e){return new(e||t)},imports:[[n.c,L,p.d,f.b]]}),t})()}}]);