(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{MgRC:function(e,t,c){"use strict";c.d(t,"a",(function(){return i})),c.d(t,"b",(function(){return o}));var s=c("fXoL"),n=c("kmKP");let i=(()=>{class e{constructor(e,t){this.elementRef=e,this.userService=t,this.permissions={}}ngOnInit(){this.checkDocLevelAccess()}checkAccess(){this.userService.currentUser.subscribe(e=>{var t,c;if(null===(t=null==e?void 0:e.docinfo)||void 0===t?void 0:t.permissions){let t=null===(c=null==e?void 0:e.docinfo)||void 0===c?void 0:c.permissions;t.hasOwnProperty(this.accessType)&&(this.elementRef.nativeElement.disabled=!(t[this.accessType]>0))}})}checkDocLevelAccess(){var e;this.permissions=JSON.parse(localStorage.getItem("checkPermissions")),(null===(e=this.permissions)||void 0===e?void 0:e.hasOwnProperty(this.accessType))&&(this.elementRef.nativeElement.style["pointer-events"]=this.permissions[this.accessType]>0?"auto":"none",this.elementRef.nativeElement.style.cursor=this.permissions[this.accessType]>0?"pointer":"not-allowed",this.elementRef.nativeElement.disabled=!(this.permissions[this.accessType]>0))}}return e.\u0275fac=function(t){return new(t||e)(s.bc(s.o),s.bc(n.a))},e.\u0275dir=s.Wb({type:e,selectors:[["","appPermissionButton",""]],inputs:{moduleType:"moduleType",accessType:"accessType"}}),e})(),o=(()=>{class e{}return e.\u0275mod=s.Zb({type:e}),e.\u0275inj=s.Yb({factory:function(t){return new(t||e)}}),e})()},eDec:function(e,t,c){"use strict";c.r(t),c.d(t,"RolesModule",(function(){return N}));var s=c("ofXK"),n=c("tyNb"),i=c("fXoL"),o=c("Kj3r"),r=c("eIep"),l=c("t0ZU"),a=c("tk/3"),d=c("1kSV"),u=c("5eHb"),h=c("MgRC"),p=c("3Pt+"),g=c("sUsA");const m=["showUsers"],f=function(){return["MMM d, y, h:mm a"]};function b(e,t){if(1&e){const e=i.ic();i.hc(0,"tr"),i.hc(1,"td"),i.cd(2),i.gc(),i.hc(3,"td"),i.cd(4),i.gc(),i.hc(5,"td"),i.cd(6),i.xc(7,"date"),i.gc(),i.hc(8,"td"),i.hc(9,"div",20),i.hc(10,"input",21,22),i.sc("ngModelChange",(function(c){return i.Qc(e),t.$implicit.status=c}))("change",(function(){i.Qc(e);const c=t.$implicit;return i.wc().switchStatus(c)})),i.gc(),i.hc(12,"label",23),i.cc(13,"small"),i.gc(),i.gc(),i.gc(),i.gc()}if(2&e){const e=t.$implicit,c=t.index,s=i.wc();i.Nb(2),i.dd(s.filters.itemsPerPage*(s.filters.currentPage-1)+(c+1)),i.Nb(2),i.dd(null==e?null:e.name),i.Nb(2),i.ed(" ",i.zc(7,8,null==e?null:e.modified,i.Hc(11,f)),""),i.Nb(4),i.Gc("id","status",c,""),i.Gc("name","status",c,""),i.Ec("ngModel",e.status)("disabled","ezy-admin"==e.name),i.Nb(2),i.Gc("for","status",c,"")}}function v(e,t){1&e&&(i.hc(0,"div",24),i.hc(1,"h5"),i.cd(2,"No Data Found"),i.gc(),i.gc())}function y(e,t){if(1&e&&(i.hc(0,"li"),i.cd(1),i.xc(2,"titlecase"),i.gc()),2&e){const e=t.$implicit;i.Nb(1),i.ed(" ",i.yc(2,1,e)," ")}}function x(e,t){1&e&&(i.hc(0,"p",32),i.cd(1," No Users"),i.gc())}function w(e,t){if(1&e&&(i.hc(0,"div",25),i.hc(1,"h6"),i.hc(2,"strong"),i.cd(3),i.gc(),i.gc(),i.hc(4,"button",26),i.sc("click",(function(){return t.$implicit.dismiss("Cross click")})),i.hc(5,"span",27),i.cd(6,"\xd7"),i.gc(),i.gc(),i.gc(),i.hc(7,"div",28),i.hc(8,"div",29),i.hc(9,"ul",30),i.ad(10,y,3,3,"li",16),i.ad(11,x,2,0,"p",31),i.gc(),i.gc(),i.gc()),2&e){const e=i.wc();i.Nb(3),i.ed("",null==e.selectedRole?null:e.selectedRole.name," "),i.Nb(7),i.Ec("ngForOf",e.usersList),i.Nb(1),i.Ec("ngIf",0==e.usersList.length)}}function O(e,t){1&e&&(i.hc(0,"small",49),i.cd(1,"Required"),i.gc())}function M(e,t){if(1&e){const e=i.ic();i.hc(0,"div",25),i.hc(1,"div",33),i.hc(2,"h5",34),i.cd(3,"Create Role"),i.gc(),i.gc(),i.hc(4,"button",35),i.sc("click",(function(){return t.$implicit.close()})),i.hc(5,"span",27),i.cd(6,"\xd7"),i.gc(),i.gc(),i.gc(),i.hc(7,"div",28),i.hc(8,"form",36,37),i.sc("ngSubmit",(function(){i.Qc(e);const c=t.$implicit,s=i.Oc(9);return i.wc().addRolesForm(s,c)})),i.hc(10,"div",38),i.hc(11,"div",39),i.hc(12,"div",40),i.hc(13,"div",41),i.hc(14,"span",42),i.cd(15,"ezy-"),i.gc(),i.gc(),i.hc(16,"input",43,44),i.sc("ngModelChange",(function(t){return i.Qc(e),i.wc().rolesObj.role_name=t})),i.gc(),i.cc(18,"br"),i.ad(19,O,2,0,"small",45),i.gc(),i.gc(),i.gc(),i.hc(20,"div",46),i.hc(21,"button",47),i.sc("click",(function(){return t.$implicit.close()})),i.cd(22,"Cancel"),i.gc(),i.hc(23,"button",48),i.cd(24,"Save"),i.gc(),i.gc(),i.gc(),i.gc()}if(2&e){const e=i.Oc(9),t=i.Oc(17),c=i.wc();i.Nb(16),i.Ec("ngModel",c.rolesObj.role_name),i.Nb(3),i.Ec("ngIf",e.submitted&&(null==t||null==t.errors?null:t.errors.required))}}class R{constructor(){this.itemsPerPage=20,this.currentPage=1,this.totalCount=100,this.search=""}}const C=[{path:"",component:(()=>{class e{constructor(e,t,c,s,n){this.http=e,this.activatedRoute=t,this.router=c,this.modal=s,this.toaster=n,this.filters=new R,this.onSearch=new i.q,this.roleList=[],this.usersList=[]}ngOnInit(){this.onSearch.pipe(Object(o.a)(500)).subscribe(e=>this.updateRouterParams()),this.getRolesData()}updateRouterParams(){this.router.navigate(["home/roles"],{queryParams:this.filters})}getRolesCount(){this.http.get(""+l.a.roles,{params:{fields:JSON.stringify(["count( `tabRole`.`name`) AS total_count"])}}).subscribe(e=>{this.filters.totalCount=e.data[0].total_count,this.getRolesData()})}getRolesData(){this.activatedRoute.queryParams.pipe(Object(r.a)(e=>{this.filters.search=e.search||this.filters.search;const t={filters:[]};return this.filters.search&&t.filters.push(["name","like",`%${this.filters.search}%`]),t.limit_page_length="None",t.order_by="`tabRole`.`creation` desc",t.fields=JSON.stringify(["*"]),t.filters=JSON.stringify(t.filters),this.http.get(""+l.a.roles,{params:t})})).subscribe(e=>{var t;(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.length)&&(this.roleList=e.data.filter(e=>null==e?void 0:e.name.includes("ezy")).map(e=>(e&&(e.status=0==(null==e?void 0:e.disabled)?1:0),e)))})}ShowUsers(e,t){this.usersList=[],this.selectedRole=e,this.modal.open(this.showUsers,{size:"md",centered:!0});const c=new FormData;c.append("doctype",l.b.user),c.append("fields",JSON.stringify(["`tabUser`.`full_name`","`tabUser`.`name`","`tabUser`.`email`"])),c.append("filters",JSON.stringify([["Has Role","role","=",""+e.name]])),this.http.post(l.a.roleByUser,c).subscribe(e=>{var t,c,s;(null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.values.length)&&(null===(s=null===(c=null==e?void 0:e.message)||void 0===c?void 0:c.values)||void 0===s||s.map(e=>{this.usersList.push(e[0])}))})}addRoles(e){this.rolesObj={},this.modal.open(e,{centered:!0,size:"md",backdrop:"static"}).result.then(e=>{})}addRolesForm(e,t){e.valid?this.http.post(l.a.roles,{data:{role_name:"ezy-"+e.value.role_name}}).subscribe(e=>{e.data&&(this.getRolesCount(),t.close(e.data),this.toaster.success("Created"))}):e.form.markAllAsTouched()}switchStatus(e){let t=e;t.disabled=(null==e?void 0:e.status)?0:1,this.http.put(`${l.a.roles}/${null==e?void 0:e.name}`,{data:t}).subscribe(e=>{(null==e?void 0:e.data)?(this.getRolesData(),this.toaster.success("Updated")):this.toaster.error("Failed to Update")})}}return e.\u0275fac=function(t){return new(t||e)(i.bc(a.b),i.bc(n.a),i.bc(n.e),i.bc(d.k),i.bc(u.d))},e.\u0275cmp=i.Vb({type:e,selectors:[["app-roles"]],viewQuery:function(e,t){var c;1&e&&i.jd(m,!0),2&e&&i.Nc(c=i.tc())&&(t.showUsers=c.first)},decls:34,vars:3,consts:[[1,"row","mb-3"],[1,"col-md-9","col-lg-9"],[1,"d-flex"],[1,"font-weight-bold","text-white"],["appPermissionButton","","accessType","create","moduleType","docType",1,"create","btn","btn-primary",3,"click"],[1,"ri-add-line"],[1,"col-lg-3","col-md-3"],[1,"position-relative","mt-2","mt-lg-0","mt-md-0"],["type","search","placeholder","Search by name",1,"form-control","pl-5",3,"ngModel","ngModelChange","keyup","search"],["search",""],[1,"search"],[1,"ri-search-line"],[1,"card"],[1,"table-responsive"],[1,"table"],[1,"thead"],[4,"ngFor","ngForOf"],["class","text-center py-3",4,"ngIf"],["showUsers",""],["rolesModel",""],[1,"custom-control","custom-switch"],["type","checkbox",1,"custom-control-input",3,"id","ngModel","name","disabled","ngModelChange","change"],["status{{i}}","ngModel"],[1,"custom-control-label",3,"for"],[1,"text-center","py-3"],[1,"modal-header"],["type","button","aria-label","Close",1,"close",3,"click"],["aria-hidden","true"],[1,"modal-body"],[1,"a-logs"],[1,"list-unstyled","px-3"],["class","text-center",4,"ngIf"],[1,"text-center"],[1,"d-flex","justify-content-between","flex-grow-1"],["id","modal-basic-title flex-grow-1",1,"mb-0"],["type","button","aria-label","Close",1,"close","mx-0",3,"click"],[3,"ngSubmit"],["form","ngForm"],[1,"row","mx-3"],[1,"col-md-12","my-1"],[1,"input-group"],[1,"input-group-prepend"],["id","basic-addon1",1,"input-group-text"],["id","role_name","autocomplete","off","type","text","name","role_name","appAlphaInput","","placeholder","Enter Role Name","required","",1,"form-control",3,"ngModel","ngModelChange"],["role_name","ngModel"],["class","text-danger",4,"ngIf"],[1,"d-flex","justify-content-center","mt-4"],["type","button",1,"btn","btn-sm","btn-outline-dark","mx-1",3,"click"],["type","submit",1,"btn","btn-sm","btn-primary","ml-20","mx-1"],[1,"text-danger"]],template:function(e,t){if(1&e){const e=i.ic();i.hc(0,"section"),i.hc(1,"div",0),i.hc(2,"div",1),i.hc(3,"div",2),i.hc(4,"h4",3),i.cd(5,"Roles"),i.gc(),i.hc(6,"button",4),i.sc("click",(function(){i.Qc(e);const c=i.Oc(33);return t.addRoles(c)})),i.cc(7,"i",5),i.gc(),i.gc(),i.gc(),i.hc(8,"div",6),i.hc(9,"div",7),i.hc(10,"input",8,9),i.sc("ngModelChange",(function(e){return t.filters.search=e}))("keyup",(function(){i.Qc(e);const c=i.Oc(11);return t.filters.search=c.value,t.onSearch.emit(t.filters)}))("search",(function(){return t.onSearch.emit(t.filters)})),i.gc(),i.hc(12,"span",10),i.cc(13,"i",11),i.gc(),i.gc(),i.gc(),i.gc(),i.hc(14,"div",12),i.hc(15,"div",13),i.hc(16,"table",14),i.hc(17,"thead",15),i.hc(18,"tr"),i.hc(19,"th"),i.cd(20,"#"),i.gc(),i.hc(21,"th"),i.cd(22,"Name"),i.gc(),i.hc(23,"th"),i.cd(24,"Last Modified "),i.gc(),i.hc(25,"th"),i.cd(26,"Status"),i.gc(),i.gc(),i.gc(),i.hc(27,"tbody"),i.ad(28,b,14,12,"tr",16),i.gc(),i.gc(),i.ad(29,v,3,0,"div",17),i.gc(),i.gc(),i.gc(),i.ad(30,w,12,3,"ng-template",null,18,i.bd),i.ad(32,M,25,2,"ng-template",null,19,i.bd)}2&e&&(i.Nb(10),i.Ec("ngModel",t.filters.search),i.Nb(18),i.Ec("ngForOf",t.roleList),i.Nb(1),i.Ec("ngIf",!t.roleList.length))},directives:[h.a,p.b,p.i,p.l,s.o,s.p,p.a,p.u,p.j,p.k,g.a,p.q],pipes:[s.f,s.x],styles:["table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:0;border-top:0;font-size:12px;padding:9px 10px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:9px 10px;font-size:14px;border:1px solid rgba(221,218,218,.3)}.role-section[_ngcontent-%COMP%]   .cursor-pointer[_ngcontent-%COMP%]{text-decoration:none}.input-group-text[_ngcontent-%COMP%]{font-size:13px!important;padding:8px}.ezy_fixed_text[_ngcontent-%COMP%]{border:1px solid;border-radius:3px;padding:5px}.roleDefault[_ngcontent-%COMP%]{color:#fe5358;font-size:6px}"]}),e})()}];let P=(()=>{class e{}return e.\u0275mod=i.Zb({type:e}),e.\u0275inj=i.Yb({factory:function(t){return new(t||e)},imports:[[n.i.forChild(C)],n.i]}),e})();var k=c("oOf3");let N=(()=>{class e{}return e.\u0275mod=i.Zb({type:e}),e.\u0275inj=i.Yb({factory:function(t){return new(t||e)},imports:[[s.c,P,p.d,k.a,h.b,g.b]]}),e})()}}]);