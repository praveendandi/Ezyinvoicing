(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{MgRC:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return l}));var a=s("fXoL"),n=s("kmKP");let r=(()=>{class e{constructor(e,t){this.elementRef=e,this.userService=t,this.permissions={}}ngOnInit(){this.checkDocLevelAccess()}checkAccess(){this.userService.currentUser.subscribe(e=>{var t,s;if(null===(t=null==e?void 0:e.docinfo)||void 0===t?void 0:t.permissions){let t=null===(s=null==e?void 0:e.docinfo)||void 0===s?void 0:s.permissions;t.hasOwnProperty(this.accessType)&&(this.elementRef.nativeElement.disabled=!(t[this.accessType]>0))}})}checkDocLevelAccess(){var e;this.permissions=JSON.parse(localStorage.getItem("checkPermissions")),(null===(e=this.permissions)||void 0===e?void 0:e.hasOwnProperty(this.accessType))&&(this.elementRef.nativeElement.disabled=!(this.permissions[this.accessType]>0))}}return e.\u0275fac=function(t){return new(t||e)(a.bc(a.o),a.bc(n.a))},e.\u0275dir=a.Wb({type:e,selectors:[["","appPermissionButton",""]],inputs:{moduleType:"moduleType",accessType:"accessType"}}),e})(),l=(()=>{class e{}return e.\u0275mod=a.Zb({type:e}),e.\u0275inj=a.Yb({factory:function(t){return new(t||e)}}),e})()},sRzU:function(e,t,s){"use strict";s.r(t),s.d(t,"UserDetailsModule",(function(){return R}));var a=s("ofXK"),n=s("tyNb"),r=s("t0ZU"),l=s("fXoL"),i=s("tk/3"),c=s("5eHb"),o=s("3Pt+"),u=s("HgEw"),d=s("ZOsW"),m=s("MgRC");function g(e,t){1&e&&(l.hc(0,"small",28),l.cd(1,"Required"),l.gc())}function p(e,t){1&e&&(l.hc(0,"small",28),l.cd(1,"Required"),l.gc())}function h(e,t){1&e&&(l.hc(0,"small",28),l.cd(1,"Required"),l.gc())}function b(e,t){1&e&&(l.hc(0,"small",28),l.cd(1,"Required"),l.gc())}function f(e,t){1&e&&(l.hc(0,"small",28),l.cd(1,"Check password pattern"),l.gc())}function v(e,t){if(1&e){const e=l.ic();l.hc(0,"div",9),l.hc(1,"div",10),l.hc(2,"input",29,30),l.sc("ngModelChange",(function(t){return l.Pc(e),l.wc().userDetails.new_password=t})),l.gc(),l.hc(4,"label",31),l.cd(5,"Password *"),l.gc(),l.hc(6,"small",32),l.cd(7,"should contain special characters and alphanumeric "),l.gc(),l.cc(8,"br"),l.ad(9,b,2,0,"small",14),l.ad(10,f,2,0,"small",14),l.gc(),l.gc()}if(2&e){const e=l.Nc(3),t=l.wc(),s=l.Nc(10);l.Nb(2),l.Dc("ngModel",t.userDetails.new_password),l.Nb(7),l.Dc("ngIf",s.submitted&&(null==e||null==e.errors?null:e.errors.required)),l.Nb(1),l.Dc("ngIf",s.submitted&&(null==e||null==e.errors?null:e.errors.pattern))}}function y(e,t){if(1&e&&(l.hc(0,"ng-option",33),l.cd(1),l.gc()),2&e){const e=t.$implicit;l.Dc("value",e.name),l.Nb(1),l.ed("",null==e?null:e.name," ")}}function D(e,t){1&e&&(l.hc(0,"small",28),l.cd(1,"Required"),l.gc())}function w(e,t){if(1&e){const e=l.ic();l.hc(0,"div",9),l.hc(1,"div",10),l.hc(2,"select",34,35),l.sc("ngModelChange",(function(t){return l.Pc(e),l.wc().userDetails.enabled=t})),l.hc(4,"option",36),l.cd(5,"Active"),l.gc(),l.hc(6,"option",37),l.cd(7,"In-Active"),l.gc(),l.gc(),l.hc(8,"label",38),l.cd(9,"Status"),l.gc(),l.gc(),l.gc()}if(2&e){const e=l.wc();l.Nb(2),l.Dc("ngModel",e.userDetails.enabled)}}const M=function(){return["/home/users"]},N=[{path:"",component:(()=>{class e{constructor(e,t,s,a){this.http=e,this.router=t,this.activateRoute=s,this.toaster=a,this.userDetails={}}ngOnInit(){this.loginUser=JSON.parse(localStorage.getItem("login")),this.paramsData=this.activateRoute.snapshot.queryParams,this.getTotalRolesCount(),this.paramsData.id&&this.getUserDetails()}getUserDetails(){this.http.get(`${r.a.users}/${this.paramsData.id}`).subscribe(e=>{this.userDetails=null==e?void 0:e.data,this.userDetails.roles=this.userDetails.roles.map(e=>e.role),this.userDetails.roles=this.userDetails.roles.filter(e=>e.includes("ezy-"))})}getTotalRolesCount(){this.http.get(""+r.a.roles,{params:{fields:JSON.stringify(["count( `tabRole`.`name`) AS total_count"])}}).subscribe(e=>{this.getRoles(e.data[0].total_count)})}getRoles(e){this.http.get(r.a.roles,{params:{limit_start:"0",limit_page_length:JSON.stringify(e),fields:JSON.stringify(["name","role_name"])}}).subscribe(e=>{this.roleList=e.data.filter(e=>e.name.includes("ezy"))})}onSubmit(e){let t=["Maintenance Manager","System Manager"];if(console.log(e.value.roles),t=t.concat(e.value.roles),e.valid){let s={docstatus:0,doctype:"Has Role",modified_by:this.loginUser.full_name,owner:this.loginUser.full_name,parent:e.value.email,parentfield:"roles",parenttype:"User",role:t},a={email:e.value.email,first_name:e.value.first_name,enabled:e.value.enabled?e.value.enabled:1,user_type:"System User",username:e.value.username};this.paramsData.id?(this.http.put(`${r.a.users}/${a.email}`,a).subscribe(e=>{e.data&&this.router.navigate(["/home/users"])}),e.value.roles&&this.http.put(""+r.a.addUserRoles,s).subscribe(e=>{e.data&&this.router.navigate(["/home/users"])})):this.http.post(r.a.users,a).subscribe(t=>{console.log(t),e.value.new_password&&this.http.put(`${r.a.users}/${e.value.email}`,{new_password:e.value.new_password}).subscribe(e=>{e.data&&setTimeout(()=>{this.http.post(""+r.a.addUserRoles,s).subscribe(e=>{this.router.navigate(["/home/users"])})},1e3)})},t=>{if(409==t.status){if(this.toaster.info("User Email is exists."),!window.confirm("Are you want sure to continue with same email ?"))return null;{let t=Math.floor(1e3+9e3*Math.random());t="Noshow"+t+e.value.email;const s=new FormData;s.append("old",e.value.email),s.append("new",t),s.append("merge","0"),s.append("doctype","User"),this.http.post(""+r.a.user_name_rename_doc,s).subscribe(t=>{(null==t?void 0:t.message)&&(this.http.put(`${r.a.users}/${null==t?void 0:t.message}`,{enabled:0,user_type:"System User"}).toPromise(),this.onSubmit(e),console.log(t))})}}})}else e.form.markAllAsTouched()}}return e.\u0275fac=function(t){return new(t||e)(l.bc(i.b),l.bc(n.e),l.bc(n.a),l.bc(c.d))},e.\u0275cmp=l.Vb({type:e,selectors:[["app-user-details"]],decls:48,vars:20,consts:[[1,"card"],[1,"card-body"],[1,"font-weight-bold"],[1,"text-muted"],[1,"text-primary","cursor-pointer",3,"routerLink","queryParamsHandling","replaceUrl"],[3,"ngSubmit"],["form","ngForm"],[1,"row"],[1,"col-lg-10","col-md-10"],[1,"col-lg-6","col-md-6"],[1,"form-group"],["type","text","appMatInput","","id","first_name","name","first_name","required","",1,"form-control",3,"ngModel","readonly","ngModelChange"],["first_name","ngModel"],["for","first_name",1,"mat-label"],["class","text-danger",4,"ngIf"],["type","text","appMatInput","","id","email","name","email","required","",1,"form-control",3,"ngModel","readonly","ngModelChange"],["email","ngModel"],["for","email",1,"mat-label"],["appMatInput","","id","userName","type","text","name","username","required","",1,"form-control",3,"ngModel","ngModelChange"],["username","ngModel"],["for","userName",1,"mat-label"],["class","col-lg-6 col-md-6",4,"ngIf"],["placeholder","select Role","name","roles","id","role","required","",1,"",3,"ngModel","multiple","ngModelChange"],["roles","ngModel"],[3,"value",4,"ngFor","ngForOf"],[1,"text-right"],["type","button",1,"btn","btn-outline-primary","mb-0","text-uppercase",3,"routerLink"],["appPermissionButton","","accessType","write","type","submit",1,"btn","btn-primary","mb-0","text-uppercase","ml-3"],[1,"text-danger"],["appMatInput","","id","newPassword","type","password","pattern","^(?=.*[A-Za-z])(?=.*\\d)(?=.*[@$!%*#?&])[A-Za-z\\d@$!%*#?&]{6,}$","name","new_password","required","",1,"form-control",3,"ngModel","ngModelChange"],["new_password","ngModel"],["for","newPassword",1,"mat-label"],[1,"text-mute"],[3,"value"],["appMatInput","","name","enabled","id","enabled",1,"custom-select",3,"ngModel","ngModelChange"],["enabled","ngModel"],["value","1"],["value","0"],["for","enabled",1,"mat-label"]],template:function(e,t){if(1&e){const e=l.ic();l.hc(0,"section"),l.hc(1,"div",0),l.hc(2,"div",1),l.hc(3,"h4",2),l.cd(4,"User"),l.gc(),l.hc(5,"p",3),l.hc(6,"a",4),l.cd(7,"Users"),l.gc(),l.cd(8,"/ Create User "),l.gc(),l.hc(9,"form",5,6),l.sc("ngSubmit",(function(){l.Pc(e);const s=l.Nc(10);return t.onSubmit(s)})),l.hc(11,"div",7),l.hc(12,"div",8),l.hc(13,"div",7),l.hc(14,"div",9),l.hc(15,"div",10),l.hc(16,"input",11,12),l.sc("ngModelChange",(function(e){return t.userDetails.first_name=e})),l.gc(),l.hc(18,"label",13),l.cd(19,"First Name *"),l.gc(),l.ad(20,g,2,0,"small",14),l.gc(),l.gc(),l.hc(21,"div",9),l.hc(22,"div",10),l.hc(23,"input",15,16),l.sc("ngModelChange",(function(e){return t.userDetails.email=e})),l.gc(),l.hc(25,"label",17),l.cd(26,"Email *"),l.gc(),l.ad(27,p,2,0,"small",14),l.gc(),l.gc(),l.hc(28,"div",9),l.hc(29,"div",10),l.hc(30,"input",18,19),l.sc("ngModelChange",(function(e){return t.userDetails.username=e})),l.gc(),l.hc(32,"label",20),l.cd(33,"UserName *"),l.gc(),l.ad(34,h,2,0,"small",14),l.gc(),l.gc(),l.ad(35,v,11,3,"div",21),l.hc(36,"div",9),l.hc(37,"div"),l.hc(38,"ng-select",22,23),l.sc("ngModelChange",(function(e){return t.userDetails.roles=e})),l.ad(40,y,2,2,"ng-option",24),l.gc(),l.ad(41,D,2,0,"small",14),l.gc(),l.gc(),l.ad(42,w,10,1,"div",21),l.gc(),l.hc(43,"div",25),l.hc(44,"button",26),l.cd(45,"Cancel"),l.gc(),l.hc(46,"button",27),l.cd(47,"Save"),l.gc(),l.gc(),l.gc(),l.gc(),l.gc(),l.gc(),l.gc(),l.gc()}if(2&e){const e=l.Nc(10),s=l.Nc(17),a=l.Nc(24),n=l.Nc(31),r=l.Nc(39);l.Nb(6),l.Dc("routerLink",l.Gc(18,M))("queryParamsHandling","preserve")("replaceUrl",!0),l.Nb(10),l.Dc("ngModel",t.userDetails.first_name)("readonly","edit"===(null==t.paramsData?null:t.paramsData.type)),l.Nb(4),l.Dc("ngIf",e.submitted&&(null==s||null==s.errors?null:s.errors.required)),l.Nb(3),l.Dc("ngModel",t.userDetails.email)("readonly","edit"===(null==t.paramsData?null:t.paramsData.type)),l.Nb(4),l.Dc("ngIf",e.submitted&&(null==a||null==a.errors?null:a.errors.required)),l.Nb(3),l.Dc("ngModel",t.userDetails.username),l.Nb(4),l.Dc("ngIf",e.submitted&&(null==n||null==n.errors?null:n.errors.required)),l.Nb(1),l.Dc("ngIf",!t.paramsData.id),l.Nb(3),l.Dc("ngModel",t.userDetails.roles)("multiple",!0),l.Nb(2),l.Dc("ngForOf",t.roleList),l.Nb(1),l.Dc("ngIf",e.submitted&&(null==r||null==r.errors?null:r.errors.required)),l.Nb(1),l.Dc("ngIf",t.paramsData.id),l.Nb(2),l.Dc("routerLink",l.Gc(19,M))}},directives:[n.h,o.u,o.j,o.k,o.b,u.a,o.q,o.i,o.l,a.p,d.a,a.o,n.f,m.a,o.o,d.d,o.r,o.m,o.t],styles:[""]}),e})()}];let _=(()=>{class e{}return e.\u0275mod=l.Zb({type:e}),e.\u0275inj=l.Yb({factory:function(t){return new(t||e)},imports:[[n.i.forChild(N)],n.i]}),e})(),R=(()=>{class e{}return e.\u0275mod=l.Zb({type:e}),e.\u0275inj=l.Yb({factory:function(t){return new(t||e)},imports:[[a.c,_,o.d,m.b,u.b,d.b]]}),e})()}}]);