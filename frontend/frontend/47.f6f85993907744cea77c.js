(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{kpHn:function(t,e,c){"use strict";c.r(e),c.d(e,"DeletedDocumentsModule",(function(){return x}));var i=c("ofXK"),n=c("tyNb"),s=c("fXoL"),o=c("cp0P"),r=c("Kj3r"),a=c("eIep"),l=c("t0ZU"),d=c("AytR"),h=c("tk/3"),u=c("1kSV"),g=c("5eHb"),f=c("3Pt+"),p=c("SYYg");function m(t,e){if(1&t){const t=s.ic();s.hc(0,"span"),s.hc(1,"a",22),s.sc("click",(function(){s.Pc(t);const e=s.wc().$implicit;return s.wc().ViewFile(e,"view")})),s.cd(2,"View"),s.gc(),s.gc()}}function b(t,e){if(1&t){const t=s.ic();s.hc(0,"span"),s.hc(1,"a",22),s.sc("click",(function(){s.Pc(t);const e=s.wc().$implicit;return s.wc().restoreFile(e,"edit")})),s.cd(2,"Restore"),s.gc(),s.gc()}}const P=function(){return["MMM d, y, h:mm a"]};function v(t,e){if(1&t&&(s.hc(0,"tr"),s.hc(1,"td"),s.cd(2),s.gc(),s.hc(3,"td"),s.cd(4),s.gc(),s.hc(5,"td"),s.cd(6),s.xc(7,"date"),s.gc(),s.hc(8,"td"),s.cd(9),s.gc(),s.hc(10,"td"),s.ad(11,m,3,0,"span",21),s.gc(),s.hc(12,"td"),s.ad(13,b,3,0,"span",21),s.gc(),s.gc()),2&t){const t=e.$implicit;s.Nb(2),s.dd(t.index),s.Nb(2),s.dd(null==t?null:t.deleted_name),s.Nb(2),s.dd(s.zc(7,6,null==t?null:t.creation,s.Gc(9,P))),s.Nb(3),s.dd(null==t?null:t.modified_by),s.Nb(2),s.Dc("ngIf",null==t?null:t.invoice_file),s.Nb(2),s.Dc("ngIf",0==(null==t?null:t.restored)&&(null==t?null:t.invoice_file))}}function y(t,e){1&t&&(s.hc(0,"div",23),s.hc(1,"h5"),s.cd(2,"No Data Found"),s.gc(),s.gc())}function D(t,e){if(1&t){const t=s.ic();s.hc(0,"div"),s.hc(1,"p",28),s.sc("click",(function(){s.Pc(t);const e=s.wc(2);return e.filters.start=e.deletedList.length,e.filters.currentPage=e.filters.currentPage+1,e.updateRouterParams()})),s.cd(2," more "),s.gc(),s.gc()}}function w(t,e){if(1&t){const t=s.ic();s.hc(0,"div",24),s.hc(1,"div",25),s.hc(2,"select",26),s.sc("ngModelChange",(function(e){return s.Pc(t),s.wc().filters.itemsPerPage=e}))("change",(function(){return s.Pc(t),s.wc().checkPagination()})),s.hc(3,"option",27),s.cd(4,"20"),s.gc(),s.hc(5,"option",27),s.cd(6,"50"),s.gc(),s.hc(7,"option",27),s.cd(8,"100"),s.gc(),s.hc(9,"option",27),s.cd(10,"150"),s.gc(),s.hc(11,"option",27),s.cd(12,"500"),s.gc(),s.gc(),s.gc(),s.ad(13,D,3,0,"div",21),s.gc()}if(2&t){const t=s.wc();s.Nb(2),s.Dc("ngModel",t.filters.itemsPerPage),s.Nb(1),s.Dc("value",20),s.Nb(2),s.Dc("value",50),s.Nb(2),s.Dc("value",100),s.Nb(2),s.Dc("value",150),s.Nb(2),s.Dc("value",500),s.Nb(2),s.Dc("ngIf",t.deletedList.length<t.filters.totalCount)}}class _{constructor(){this.itemsPerPage=20,this.currentPage=1,this.totalCount=100,this.search="",this.start=0}}const N=[{path:"",component:(()=>{class t{constructor(t,e,c,i,n){this.http=t,this.activatedRoute=e,this.router=c,this.modal=i,this.toastr=n,this.filters=new _,this.onSearch=new s.q,this.deletedList=[],this.apiDomain=d.a.apiDomain}ngOnInit(){var t;this.companyDetails=JSON.parse(localStorage.getItem("company")),this.filters.itemsPerPage=null===(t=this.companyDetails)||void 0===t?void 0:t.items_per_page,this.onSearch.pipe(Object(r.a)(500)).subscribe(t=>{this.updateRouterParams(),this.filters.start=0,this.filters.totalCount=0}),this.getTotalCount()}updateRouterParams(){this.router.navigate(["home/deleted-documents"],{queryParams:this.filters})}getTotalCount(){this.http.get(`${l.a.resource}/${l.b.deleteDocument}`,{params:{fields:JSON.stringify(["count( `tabDeleted Document`.`name`) AS total_count"])}}).subscribe(t=>{this.filters.totalCount=t.data[0].total_count,this.getDocumentList()})}getDocumentList(){this.activatedRoute.queryParams.pipe(Object(a.a)(t=>{this.filters.totalCount=parseInt(t.totalCount,0)||this.filters.totalCount,this.filters.search=t.search||this.filters.search;const e={filters:[]};this.filters.search&&e.filters.push(["deleted_name","like",`%${this.filters.search}%`]),e.filters.push(["deleted_doctype","like",l.b.invoices]),e.limit_page_length=this.filters.itemsPerPage,e.limit_start=(this.filters.currentPage-1)*this.filters.itemsPerPage,e.order_by="`tabDeleted Document`.`modified` desc",e.fields=JSON.stringify(["name","creation","modified","modified_by","deleted_name","deleted_doctype","restored","data"]),e.filters=JSON.stringify(e.filters);const c=this.http.get(`${l.a.resource}/${l.b.deleteDocument}`,{params:{fields:JSON.stringify(["count( `tabDeleted Document`.`name`) AS total_count"]),filters:e.filters}}),i=this.http.get(`${l.a.resource}/${l.b.deleteDocument}`,{params:e});return Object(o.a)([c,i])})).subscribe(t=>{1==this.filters.currentPage&&(this.deletedList=[]);const[e,c]=t;c.data=c.data.map((t,e)=>(t&&(t.invoice_file=JSON.parse(t.data).invoice_file,t.index=this.deletedList.length+e+1),t)),this.filters.totalCount=e.data[0].total_count,c.data&&(this.deletedList=1!==this.filters.currentPage?this.deletedList.concat(c.data):c.data)})}ViewFile(t){window.open(`${this.apiDomain}${t.invoice_file}`)}restoreFile(t){const e=new FormData;e.append("name",t.name),this.http.post(l.a.restoreFile,e).subscribe(t=>{if(t){let e=JSON.stringify(t._server_messages),c=e.includes("already exists"),i=e.includes("Document Restored");c&&this.toastr.error("Already Exists"),i&&(this.toastr.success("Restored Successfully"),this.getDocumentList())}})}checkPagination(){console.log(this.deletedList.length),this.filters.currentPage=1,this.updateRouterParams()}}return t.\u0275fac=function(e){return new(e||t)(s.bc(h.b),s.bc(n.a),s.bc(n.e),s.bc(u.k),s.bc(g.d))},t.\u0275cmp=s.Vb({type:t,selectors:[["app-deleted-documents"]],decls:39,vars:6,consts:[[1,"row","mb-3"],[1,"col-md-9","col-lg-9"],[1,"d-flex"],[1,"font-weight-bold","text-white"],[1,"col-lg-3","col-md-3"],[1,"position-relative","mt-2","mt-lg-0","mt-md-0"],["type","search","placeholder","Search by invoice number",1,"form-control","pl-5",3,"ngModel","ngModelChange","keyup","search"],["search",""],[1,"search"],[1,"ri-search-line"],[1,"card","pb-2"],[1,"table-responsive"],[3,"items"],["scroll",""],[1,"table"],[1,"thead"],["head",""],["container",""],[4,"ngFor","ngForOf"],["class","text-center py-3",4,"ngIf"],["class","d-flex justify-content-between",4,"ngIf"],[4,"ngIf"],["appPermissionButton","","accessType","write","moduleType","docType",1,"",3,"click"],[1,"text-center","py-3"],[1,"d-flex","justify-content-between"],[1,"px-3"],["name","itemsPerPage","id","itemsPerPage",1,"custom-select",3,"ngModel","ngModelChange","change"],[3,"value"],[1,"text-right","pr-5","more","text-primary",3,"click"]],template:function(t,e){if(1&t){const t=s.ic();s.hc(0,"section"),s.hc(1,"div",0),s.hc(2,"div",1),s.hc(3,"div",2),s.hc(4,"h4",3),s.cd(5,"Deleted Invoices "),s.hc(6,"small"),s.cd(7),s.gc(),s.gc(),s.gc(),s.gc(),s.hc(8,"div",4),s.hc(9,"div",5),s.hc(10,"input",6,7),s.sc("ngModelChange",(function(t){return e.filters.search=t}))("keyup",(function(){s.Pc(t);const c=s.Nc(11);return e.filters.search=c.value,e.onSearch.emit(e.filters)}))("search",(function(){return e.onSearch.emit(e.filters)})),s.gc(),s.hc(12,"span",8),s.cc(13,"i",9),s.gc(),s.gc(),s.gc(),s.gc(),s.hc(14,"div",10),s.hc(15,"div",11),s.hc(16,"virtual-scroller",12,13),s.hc(18,"table",14),s.hc(19,"thead",15,16),s.hc(21,"tr"),s.hc(22,"th"),s.cd(23,"#"),s.gc(),s.hc(24,"th"),s.cd(25,"Invoice Number"),s.gc(),s.hc(26,"th"),s.cd(27,"Deleted At"),s.gc(),s.hc(28,"th"),s.cd(29,"Deleted By"),s.gc(),s.hc(30,"th"),s.cd(31,"File"),s.gc(),s.hc(32,"th"),s.cd(33,"Actions"),s.gc(),s.gc(),s.gc(),s.hc(34,"tbody",null,17),s.ad(36,v,14,10,"tr",18),s.gc(),s.gc(),s.gc(),s.ad(37,y,3,0,"div",19),s.ad(38,w,14,7,"div",20),s.gc(),s.gc(),s.gc()}if(2&t){const t=s.Nc(17);s.Nb(7),s.ed("(",e.filters.totalCount,")"),s.Nb(3),s.Dc("ngModel",e.filters.search),s.Nb(6),s.Dc("items",e.deletedList),s.Nb(20),s.Dc("ngForOf",t.viewPortItems),s.Nb(1),s.Dc("ngIf",!e.deletedList.length),s.Nb(1),s.Dc("ngIf",e.deletedList.length)}},directives:[f.b,f.i,f.l,p.a,i.o,i.p,f.r,f.m,f.t],pipes:[i.f],styles:[".more[_ngcontent-%COMP%]{text-decoration:underline;cursor:pointer}table[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{border-bottom:0;border-top:0;font-size:12px;padding:9px 10px}.table[_ngcontent-%COMP%]   td[_ngcontent-%COMP%], .table[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{padding:9px 10px;font-size:14px;border:1px solid rgba(221,218,218,.3)}virtual-scroller[_ngcontent-%COMP%]{width:100%;height:500px}.custom-select[_ngcontent-%COMP%]{font-size:14px;height:32px;border:0}"]}),t})()}];let C=(()=>{class t{}return t.\u0275mod=s.Zb({type:t}),t.\u0275inj=s.Yb({factory:function(e){return new(e||t)},imports:[[n.i.forChild(N)],n.i]}),t})(),x=(()=>{class t{}return t.\u0275mod=s.Zb({type:t}),t.\u0275inj=s.Yb({factory:function(e){return new(e||t)},imports:[[i.c,C,f.d,u.m,p.b]]}),t})()}}]);