(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{MgRC:function(e,t,o){"use strict";o.d(t,"a",(function(){return s})),o.d(t,"b",(function(){return r}));var a=o("fXoL"),i=o("kmKP");let s=(()=>{class e{constructor(e,t){this.elementRef=e,this.userService=t,this.permissions={}}ngOnInit(){this.checkDocLevelAccess()}checkAccess(){this.userService.currentUser.subscribe(e=>{var t,o;if(null===(t=null==e?void 0:e.docinfo)||void 0===t?void 0:t.permissions){let t=null===(o=null==e?void 0:e.docinfo)||void 0===o?void 0:o.permissions;t.hasOwnProperty(this.accessType)&&(this.elementRef.nativeElement.disabled=!(t[this.accessType]>0))}})}checkDocLevelAccess(){var e;this.permissions=JSON.parse(localStorage.getItem("checkPermissions")),(null===(e=this.permissions)||void 0===e?void 0:e.hasOwnProperty(this.accessType))&&(this.elementRef.nativeElement.disabled=!(this.permissions[this.accessType]>0))}}return e.\u0275fac=function(t){return new(t||e)(a.bc(a.o),a.bc(i.a))},e.\u0275dir=a.Wb({type:e,selectors:[["","appPermissionButton",""]],inputs:{moduleType:"moduleType",accessType:"accessType"}}),e})(),r=(()=>{class e{}return e.\u0275mod=a.Zb({type:e}),e.\u0275inj=a.Yb({factory:function(t){return new(t||e)}}),e})()},hEQw:function(e,t,o){"use strict";o.r(t),o.d(t,"ReportsModule",(function(){return R}));var a=o("ofXK"),i=o("tyNb"),s=o("F2Ga"),r=o.n(s),n=o("t0ZU"),c=o("AytR"),l=o("wd/R"),p=o("eIep"),d=o("LRne"),u=o("fXoL"),h=o("tk/3"),m=o("3Pt+"),f=o("1kSV"),g=o("MgRC"),D=o("z17N");function b(e,t){if(1&e&&(u.hc(0,"option",18),u.cd(1),u.gc()),2&e){const e=t.$implicit;u.Dc("value",null==e?null:e.name),u.Nb(1),u.dd(null==e?null:e.name)}}function v(e,t){if(1&e){const e=u.ic();u.hc(0,"select",5),u.sc("ngModelChange",(function(t){return u.Pc(e),u.wc().filterDate.default_Date=t}))("ngModelChange",(function(){return u.Pc(e),u.wc().onDateFilterChange()})),u.hc(1,"option",19),u.cd(2,"Today"),u.gc(),u.hc(3,"option",20),u.cd(4,"Yesterday"),u.gc(),u.hc(5,"option",21),u.cd(6,"This Week"),u.gc(),u.hc(7,"option",22),u.cd(8,"Last Week"),u.gc(),u.hc(9,"option",23),u.cd(10,"This Month"),u.gc(),u.hc(11,"option",24),u.cd(12,"Last Month"),u.gc(),u.hc(13,"option",25),u.cd(14,"This Year"),u.gc(),u.hc(15,"option",26),u.cd(16,"Custom"),u.gc(),u.gc()}if(2&e){const e=u.wc();u.Dc("ngModel",e.filterDate.default_Date)}}function y(e,t){if(1&e){const e=u.ic();u.hc(0,"div",27),u.hc(1,"input",28),u.sc("ngModelChange",(function(t){return u.Pc(e),u.wc().filterDate.custom=t}))("dateTimeChange",(function(){return u.Pc(e),u.wc().updateRouterParams()})),u.gc(),u.hc(2,"span",29),u.cc(3,"i",30),u.gc(),u.cc(4,"owl-date-time",31,32),u.gc()}if(2&e){const e=u.Nc(5),t=u.wc();u.Nb(1),u.Dc("ngModel",t.filterDate.custom)("owlDateTime",e)("selectMode","range")("owlDateTimeTrigger",e),u.Nb(1),u.Dc("owlDateTimeTrigger",e),u.Nb(2),u.Dc("pickerType","calendar")}}class w{constructor(){this.default_Date="This Week",this.from_date="",this.to_date="",this.custom="",this.reportType=""}}let T=(()=>{class e{constructor(e,t,o){this.http=e,this.activatedRoute=t,this.router=o,this.filterDate=new w,this.colList=[],this.valueList=[],this.apiDomain=c.a.apiDomain,this.reportTypeList=[],this.colListXL=[]}ngOnInit(){this.activatedRoute.queryParams.subscribe(e=>{e&&(this.filterDate.reportType=null==e?void 0:e.reportType)}),this.company=JSON.parse(localStorage.getItem("company")),console.log(this.company),this.getTotalCountReports()}updateRouterParams(){this.router.navigate(["home/reports"],{queryParams:this.filterDate})}exportData(e){var t;let o={data:{company:null===(t=this.company)||void 0===t?void 0:t.name,columns:this.colListXL,values:this.valueList,report_name:this.filterDate.reportType,file_type:e}};this.http.post(n.a.reportMethod,o).subscribe(e=>{(null==e?void 0:e.message)&&window.open(`${this.apiDomain}${e.message}`,"_blank")})}remove(e){var t;let o={data:{company:null===(t=this.company)||void 0===t?void 0:t.name,filepath:e}};this.http.post(n.a.deleteReportFile,o).subscribe(e=>console.log("deleteeee",e))}getTotalCountReports(){this.http.get(n.a.reportList,{params:{fields:JSON.stringify(["count( `tabReport`.`name`) AS total_count"])}}).subscribe(e=>{this.getReportsTypes(null==e?void 0:e.data[0].total_count)})}getReportsTypes(e){const t={filters:JSON.stringify([["Report","ref_doctype","in",[n.b.invoices,n.b.deleteDocument]],["Report","disabled","=",0],["Report","name","!=","Amendment SAC HSN Summary"],["Report","name","!=","Amendment"]])};t.page_length=e,t.order_by="`tabReport`.`creation` asc",this.http.get(n.a.reportList,{params:t}).subscribe(e=>{this.reportTypeList=null==e?void 0:e.data,console.log(this.reportTypeList),0==this.company.e_invoice_missing_date_feature?this.reportTypeList.splice(17,2):this.reportTypeList=null==e?void 0:e.data,this.filterDate.reportType=this.reportTypeList[0].name,this.getActivatedParamsData()})}onreportTypeChange(e){this.updateRouterParams()}onDateFilterChange(){this.filterDate.custom="",this.filterDate.from_date="",this.filterDate.to_date="",this.updateRouterParams()}getActivatedParamsData(){let e=document.querySelector("#datatable");this.activatedRoute.queryParams.pipe(Object(p.a)(e=>{let t;if(this.filterDate.default_Date=e.default_Date||this.filterDate.default_Date,this.filterDate.reportType=e.reportType||this.filterDate.reportType,"Custom"===this.filterDate.default_Date&&e.custom&&2==e.custom.length)this.filterDate.custom=[new Date(e.custom[0]),new Date(e.custom[1])],t=new Y("Reports",this.filterDate.default_Date,this.filterDate.custom).filter;else{if("Custom"===this.filterDate.default_Date)return Object(d.a)(null);t=new Y("Reports",this.filterDate.default_Date).filter}let o={report_name:this.filterDate.reportType};return"Irn Due Report"!=this.filterDate.reportType&&"Irn Expired Report"!=this.filterDate.reportType&&(o.filters=JSON.stringify({from_date:t[0],to_date:t[1]})),console.log(t),this.http.get(n.a.reports,{params:o})})).subscribe(t=>{var o,a,i;if(t){this.colListXL=null===(o=null==t?void 0:t.message)||void 0===o?void 0:o.columns.map(e=>e.label),this.valueList=null===(a=null==t?void 0:t.message)||void 0===a?void 0:a.result.map(e=>Object.values(e)),this.colList=null===(i=null==t?void 0:t.message)||void 0===i?void 0:i.columns.map(e=>{let t={};return t.name=null==e?void 0:e.label,t.width=170,t});let s={columns:this.colList,data:this.valueList,dropdownButton:"\u25bc",headerDropdown:[{label:"Custom Action",action:function(e){}}],sortIndicator:{asc:"\u2191",desc:"\u2193",none:""},serialNoColumn:!0,noDataMessage:"No Data",inlineFilters:!0};console.log("Options ====",s),new r.a(e,s)}else console.log("===============")})}}return e.\u0275fac=function(t){return new(t||e)(u.bc(h.b),u.bc(i.a),u.bc(i.e))},e.\u0275cmp=u.Vb({type:e,selectors:[["app-reports"]],decls:24,vars:4,consts:[[1,"row","mb-3"],[1,"col-md-9","col-lg-9"],[1,"d-flex"],[1,"text-white"],[1,"form-group","ml-3","w-c-50"],["id","my-select","name","",1,"custom-select",3,"ngModel","ngModelChange"],[3,"value",4,"ngFor","ngForOf"],[1,"form-group","w-c-50","ml-1"],["id","my-select","class","custom-select","name","",3,"ngModel","ngModelChange",4,"ngIf"],["class","form-group calendar w-c-50 position-relative ml-1",4,"ngIf"],[1,"col-md-3","col-lg-3","text-right"],["ngbDropdown","",1,"d-inline-block"],["id","dropdownBasic1","appPermissionButton","","accessType","export","ngbDropdownToggle","",1,"btn","btn-primary"],["ngbDropdownMenu","","aria-labelledby","dropdownBasic1"],["ngbDropdownItem","",3,"click"],[1,"btn","btn-primary","mb-0","text-case","ml-3",3,"click"],[1,"card"],["id","datatable"],[3,"value"],["value","Today"],["value","Yesterday"],["value","This Week"],["value","Last Week"],["value","This Month"],["value","Last Month"],["value","This Year"],["value","Custom"],[1,"form-group","calendar","w-c-50","position-relative","ml-1"],["placeholder","Date Time",1,"form-control","h-auto",3,"ngModel","owlDateTime","selectMode","owlDateTimeTrigger","ngModelChange","dateTimeChange"],[1,"example-trigger",3,"owlDateTimeTrigger"],[1,"ri-calendar-2-line"],[3,"pickerType"],["dt1",""]],template:function(e,t){1&e&&(u.hc(0,"section"),u.hc(1,"div",0),u.hc(2,"div",1),u.hc(3,"div",2),u.hc(4,"h4",3),u.hc(5,"b"),u.cd(6,"Reports"),u.gc(),u.gc(),u.hc(7,"div",4),u.hc(8,"select",5),u.sc("ngModelChange",(function(e){return t.filterDate.reportType=e}))("ngModelChange",(function(e){return t.onreportTypeChange(e)})),u.ad(9,b,2,2,"option",6),u.gc(),u.gc(),u.hc(10,"div",7),u.ad(11,v,17,1,"select",8),u.gc(),u.ad(12,y,6,6,"div",9),u.gc(),u.gc(),u.hc(13,"div",10),u.hc(14,"div",11),u.hc(15,"button",12),u.cd(16,"Export"),u.gc(),u.hc(17,"div",13),u.hc(18,"button",14),u.sc("click",(function(){return t.exportData("Excel")})),u.cd(19,"Excel"),u.gc(),u.gc(),u.gc(),u.hc(20,"button",15),u.sc("click",(function(){return t.getActivatedParamsData()})),u.cd(21,"Refresh"),u.gc(),u.gc(),u.gc(),u.hc(22,"div",16),u.cc(23,"div",17),u.gc(),u.gc()),2&e&&(u.Nb(8),u.Dc("ngModel",t.filterDate.reportType),u.Nb(1),u.Dc("ngForOf",t.reportTypeList),u.Nb(2),u.Dc("ngIf","Irn Expired Report"!=t.filterDate.reportType&&"Irn Due Report"!=t.filterDate.reportType),u.Nb(1),u.Dc("ngIf","Custom"==(null==t.filterDate?null:t.filterDate.default_Date)))},directives:[m.r,m.i,m.l,a.o,a.p,f.e,g.a,f.j,f.h,f.g,m.m,m.t,m.b,D.d,D.f,D.c],styles:[""]}),e})();class Y{constructor(e,t,o){switch(t){case"Today":const e=l(new Date).format("YYYY-MM-DD");this.filter=[e,e];break;case"Yesterday":const t=l(new Date).subtract(1,"day").format("YYYY-MM-DD");this.filter=[t,t];break;case"This Week":const a=l(new Date).startOf("week").format("YYYY-MM-DD"),i=l(new Date).endOf("week").format("YYYY-MM-DD");this.filter=[a,i];break;case"Last Week":const s=l(new Date).subtract(1,"week").startOf("week").format("YYYY-MM-DD"),r=l(new Date).subtract(1,"week").endOf("week").format("YYYY-MM-DD");this.filter=[s,r];break;case"This Month":const n=l(new Date).startOf("month").format("YYYY-MM-DD"),c=l(new Date).endOf("month").format("YYYY-MM-DD");this.filter=[n,c];break;case"Last Month":const p=l(new Date).subtract(1,"month").startOf("month").format("YYYY-MM-DD"),d=l(new Date).subtract(1,"month").endOf("month").format("YYYY-MM-DD");this.filter=[p,d];break;case"This Year":const u=l(new Date).startOf("year").format("YYYY-MM-DD"),h=l(new Date).endOf("year").format("YYYY-MM-DD");this.filter=[u,h];break;case"Custom":const[m,f]=o,g=l(m).format("YYYY-MM-DD"),D=l(f).format("YYYY-MM-DD");this.filter=[g,D]}}missingDateFeature(){}}const M=[{path:"",component:T}];let k=(()=>{class e{}return e.\u0275mod=u.Zb({type:e}),e.\u0275inj=u.Yb({factory:function(t){return new(t||e)},imports:[[i.i.forChild(M)],i.i]}),e})(),R=(()=>{class e{}return e.\u0275mod=u.Zb({type:e}),e.\u0275inj=u.Yb({factory:function(t){return new(t||e)},imports:[[a.c,k,f.i,m.d,D.e,D.g,g.b]]}),e})()}}]);